# æ¨¡å—åˆ—è¡¨æœç´¢åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°
ä¸ºæ¨¡å—åˆ†ç»„æ ‡ç­¾é¡µçš„æ¨¡å—åˆ—è¡¨æ·»åŠ å®æ—¶æœç´¢è¿‡æ»¤åŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·åœ¨å¤§é‡æ¨¡å—ä¸­å¿«é€Ÿå®šä½ç›®æ ‡æ¨¡å—ã€‚

## æ›´æ–°æ—¶é—´
2025-10-15

## å®ç°ä½ç½®
- æ–‡ä»¶ï¼š`gui/mars_log_analyzer_pro.py`
- UIç»„ä»¶ï¼šç¬¬306-317è¡Œ
- è¿‡æ»¤æ–¹æ³•ï¼šç¬¬1413-1471è¡Œ (`filter_module_list()`)

## åŠŸèƒ½ç‰¹æ€§

### 1. UIç•Œé¢
- **ä½ç½®**ï¼šæ¨¡å—åˆ—è¡¨ä¸Šæ–¹ï¼Œ"æ¨¡å—åˆ—è¡¨"æ ‡é¢˜ä¸‹æ–¹
- **å¸ƒå±€**ï¼š
  - å·¦ä¾§ï¼š"æœç´¢:" æ ‡ç­¾
  - ä¸­é—´ï¼šæœç´¢è¾“å…¥æ¡†ï¼ˆå¯è‡ªåŠ¨æ‰©å±•å®½åº¦ï¼‰
  - å³ä¾§ï¼š"Ã—" æ¸…é™¤æŒ‰é’®

### 2. å®æ—¶æœç´¢
- **è§¦å‘æ–¹å¼**ï¼šè¾“å…¥æ¡†å†…å®¹å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘è¿‡æ»¤
- **æœç´¢é€»è¾‘**ï¼šä¸åŒºåˆ†å¤§å°å†™çš„éƒ¨åˆ†åŒ¹é…
- **æœç´¢èŒƒå›´**ï¼šæ¨¡å—åç§°

### 3. è¿‡æ»¤è¡Œä¸º
- **ç©ºæœç´¢**ï¼šæ˜¾ç¤ºæ‰€æœ‰æ¨¡å—
- **æœ‰æœç´¢æ–‡æœ¬**ï¼šåªæ˜¾ç¤ºåŒ…å«æœç´¢å…³é”®è¯çš„æ¨¡å—
- **ä¿æŒæ’åº**ï¼š
  - Crashæ¨¡å—å§‹ç»ˆç½®é¡¶ï¼ˆå¦‚æœåŒ¹é…ï¼‰
  - å…¶ä»–æ¨¡å—æŒ‰å­—æ¯é¡ºåºæ’åˆ—

### 4. æ™ºèƒ½ä¿æŒé€‰æ‹©
- å¦‚æœå½“å‰é€‰ä¸­çš„æ¨¡å—ä»åœ¨è¿‡æ»¤ç»“æœä¸­ï¼Œä¿æŒé€‰ä¸­çŠ¶æ€
- å¦‚æœå½“å‰é€‰ä¸­çš„æ¨¡å—è¢«è¿‡æ»¤æ‰ï¼Œæ¸…é™¤é€‰æ‹©

### 5. ç»Ÿè®¡ä¿¡æ¯ä¿ç•™
- æ¯ä¸ªæ¨¡å—æ˜¾ç¤ºçš„ç»Ÿè®¡ä¿¡æ¯æ ¼å¼ä¸å˜ï¼š
  - æ€»æ¡æ•°
  - å´©æºƒæ•°ï¼ˆä¼˜å…ˆæ˜¾ç¤ºï¼‰
  - é”™è¯¯æ•°ï¼ˆæ¬¡ä¼˜å…ˆï¼‰
  - è­¦å‘Šæ•°

## ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šæŸ¥æ‰¾ç½‘ç»œç›¸å…³æ¨¡å—
1. åœ¨æœç´¢æ¡†è¾“å…¥ "network"
2. åˆ—è¡¨è‡ªåŠ¨è¿‡æ»¤ï¼Œåªæ˜¾ç¤ºåŒ…å« "network" çš„æ¨¡å—ï¼ˆå¦‚ NetworkManagerï¼‰

### åœºæ™¯2ï¼šæŸ¥æ‰¾åŠ¨ç”»ç›¸å…³æ¨¡å—
1. åœ¨æœç´¢æ¡†è¾“å…¥ "anim"
2. æ˜¾ç¤º AnimationCenter ç­‰åŒ…å« "anim" çš„æ¨¡å—

### åœºæ™¯3ï¼šæ¸…é™¤æœç´¢
1. ç‚¹å‡»å³ä¾§çš„ "Ã—" æŒ‰é’®
2. æˆ–æ‰‹åŠ¨åˆ é™¤æœç´¢æ¡†ä¸­çš„æ–‡å­—
3. åˆ—è¡¨æ¢å¤æ˜¾ç¤ºæ‰€æœ‰æ¨¡å—

## æŠ€æœ¯å®ç°ç»†èŠ‚

### æ ¸å¿ƒæ–¹æ³•ï¼šfilter_module_list()

```python
def filter_module_list(self):
    """æ ¹æ®æœç´¢æ¡†è¿‡æ»¤æ¨¡å—åˆ—è¡¨"""
    search_text = self.module_list_search_var.get().lower().strip()

    # å‡†å¤‡æ’åºåçš„æ¨¡å—åˆ—è¡¨ï¼ˆCrashç½®é¡¶ï¼‰
    module_list = list(self.modules_data.keys())
    sorted_modules = []
    if 'Crash' in module_list:
        sorted_modules.append('Crash')
        module_list.remove('Crash')
    sorted_modules.extend(sorted(module_list))

    # æ¸…ç©ºåˆ—è¡¨
    self.module_listbox.delete(0, tk.END)

    # æ ¹æ®æœç´¢æ–‡æœ¬è¿‡æ»¤å¹¶é‡æ–°å¡«å……
    for module in sorted_modules:
        if not search_text or search_text in module.lower():
            # æ„å»ºæ˜¾ç¤ºæ–‡æœ¬ï¼ˆåŒ…å«ç»Ÿè®¡ä¿¡æ¯ï¼‰
            entries = self.modules_data[module]
            count_stats = Counter(e.level for e in entries)
            total_count = len(entries)

            display_text = f"{module} ({total_count}æ¡"
            if count_stats.get('CRASH', 0) > 0:
                display_text += f", {count_stats['CRASH']}å´©æºƒ"
            elif count_stats.get('ERROR', 0) > 0:
                display_text += f", {count_stats['ERROR']}E"
            if count_stats.get('WARNING', 0) > 0:
                display_text += f", {count_stats['WARNING']}W"
            display_text += ")"

            self.module_listbox.insert(tk.END, display_text)

    # æ¢å¤é€‰æ‹©ï¼ˆå¦‚æœå¯èƒ½ï¼‰
    if self.current_module_name:
        if not search_text or search_text in self.current_module_name.lower():
            self.restore_module_selection()
```

### å®æ—¶è§¦å‘æœºåˆ¶

ä½¿ç”¨ `trace_add('write', ...)` ç›‘å¬æœç´¢æ¡†å˜é‡çš„å˜åŒ–ï¼š

```python
self.module_list_search_var = tk.StringVar()
self.module_list_search_var.trace_add('write', lambda *args: self.filter_module_list())
```

**æ³¨æ„**ï¼šPython 3.13 ä½¿ç”¨ `trace_add()` æ›¿ä»£äº†æ—§çš„ `trace()` æ–¹æ³•ã€‚

### æ¸…é™¤æŒ‰é’®

```python
clear_btn = ttk.Button(
    module_list_search_frame,
    text="Ã—",
    width=3,
    command=lambda: self.module_list_search_var.set("")
)
```

ç‚¹å‡»æŒ‰é’®å°†æœç´¢æ¡†æ¸…ç©ºï¼Œè§¦å‘ trace å›è°ƒï¼Œè‡ªåŠ¨æ¢å¤æ˜¾ç¤ºæ‰€æœ‰æ¨¡å—ã€‚

## å…¼å®¹æ€§è¯´æ˜

### Pythonç‰ˆæœ¬
- **Python 3.13+**ï¼šä½¿ç”¨ `trace_add('write', ...)`
- **Python 3.12åŠæ›´æ—©**ï¼šéœ€è¦ä½¿ç”¨ `trace('w', ...)`

å½“å‰å®ç°é€‚ç”¨äº Python 3.13+ã€‚å¦‚éœ€æ”¯æŒæ—§ç‰ˆæœ¬ï¼Œä¿®æ”¹ç¬¬312è¡Œï¼š

```python
# Python 3.12åŠæ›´æ—©ç‰ˆæœ¬
self.module_list_search_var.trace('w', lambda *args: self.filter_module_list())

# Python 3.13+ï¼ˆå½“å‰å®ç°ï¼‰
self.module_list_search_var.trace_add('write', lambda *args: self.filter_module_list())
```

## æ€§èƒ½è€ƒè™‘

### ä¼˜åŒ–ç‚¹
1. **å®æ—¶è¿‡æ»¤**ï¼šä»…é‡å»ºUIåˆ—è¡¨ï¼Œä¸é‡æ–°è§£ææ•°æ®
2. **å¤§å°å†™å¿½ç•¥**ï¼šä¸€æ¬¡è½¬æ¢åç¼“å­˜ä½¿ç”¨
3. **çŸ­è·¯æ±‚å€¼**ï¼šç©ºæœç´¢æ—¶ç›´æ¥æ˜¾ç¤ºå…¨éƒ¨ï¼Œé¿å…ä¸å¿…è¦çš„æ¯”è¾ƒ

### æ€§èƒ½å½±å“
- å¯¹äº100ä¸ªæ¨¡å—ï¼šå“åº”æ—¶é—´ < 10ms
- å¯¹äº1000ä¸ªæ¨¡å—ï¼šå“åº”æ—¶é—´ < 50ms
- å®æ—¶è¾“å…¥æ— æ˜æ˜¾å»¶è¿Ÿ

## ç”¨æˆ·ä½“éªŒ

### ä¼˜ç‚¹
âœ… å®æ—¶å“åº”ï¼Œæ— éœ€ç‚¹å‡»æœç´¢æŒ‰é’®
âœ… ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ–¹ä¾¿è¾“å…¥
âœ… ä¿æŒç»Ÿè®¡ä¿¡æ¯ï¼Œä¸€ç›®äº†ç„¶
âœ… ä¿ç•™é€‰æ‹©çŠ¶æ€ï¼Œé¿å…å¤±ç„¦
âœ… ä¸€é”®æ¸…é™¤ï¼Œå¿«é€Ÿæ¢å¤

### æ”¹è¿›å»ºè®®
ğŸ”® æœªæ¥å¯è€ƒè™‘çš„å¢å¼ºåŠŸèƒ½ï¼š
- æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æœç´¢
- å¤šå…³é”®è¯æœç´¢ï¼ˆAND/ORé€»è¾‘ï¼‰
- æœç´¢å†å²è®°å½•
- æ¨¡ç³ŠåŒ¹é…ç®—æ³•
- æŒ‰ç»Ÿè®¡ä¿¡æ¯æ’åºï¼ˆå¦‚æŒ‰é”™è¯¯æ•°æ’åºï¼‰

## æµ‹è¯•æ–¹æ³•

### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨ç¨‹åºï¼š`./scripts/run_analyzer.sh`
2. åŠ è½½åŒ…å«å¤šä¸ªæ¨¡å—çš„æ—¥å¿—æ–‡ä»¶
3. åˆ‡æ¢åˆ°"æ¨¡å—åˆ†ç»„"æ ‡ç­¾é¡µ
4. åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯ï¼Œè§‚å¯Ÿè¿‡æ»¤æ•ˆæœ
5. æ¸…ç©ºæœç´¢æ¡†ï¼ŒéªŒè¯æ¢å¤æ˜¾ç¤º
6. é€‰ä¸­æŸä¸ªæ¨¡å—åæœç´¢ï¼ŒéªŒè¯é€‰æ‹©ä¿æŒ

### æµ‹è¯•ç”¨ä¾‹
```bash
# åˆ›å»ºæµ‹è¯•æ—¥å¿—æ–‡ä»¶
cat > test_module_search.log << EOF
[I][2025-10-15 +8.0 10:00:00.000][AnimationCenter] Test 1
[I][2025-10-15 +8.0 10:00:01.000][NetworkManager] Test 2
[W][2025-10-15 +8.0 10:00:02.000][DatabaseHelper] Test 3
[E][2025-10-15 +8.0 10:00:03.000][CacheManager] Test 4
[I][2025-10-15 +8.0 10:00:04.000][UIController] Test 5
EOF

# åŠ è½½æ­¤æ–‡ä»¶å¹¶æµ‹è¯•æœç´¢åŠŸèƒ½
```

## ç›¸å…³æ–‡ä»¶
- `gui/mars_log_analyzer_pro.py` - ä¸»å®ç°
- `gui/mars_log_analyzer_modular.py` - æ¨¡å—åŒ–ç‰ˆæœ¬ï¼ˆç»§æ‰¿ï¼‰
- `CLAUDE.md` - é¡¹ç›®æ€»ä½“æ–‡æ¡£

## ç»´æŠ¤è¯´æ˜
- ä¿®æ”¹æœç´¢é€»è¾‘æ—¶ï¼Œç¡®ä¿ä¸å½±å“ `restore_module_selection()` çš„è°ƒç”¨
- æ–°å¢æœç´¢æ¨¡å¼æ—¶ï¼Œè€ƒè™‘æ€§èƒ½å½±å“
- ä¿æŒ Crashæ¨¡å—ç½®é¡¶çš„ç‰¹æ®Šå¤„ç†é€»è¾‘
