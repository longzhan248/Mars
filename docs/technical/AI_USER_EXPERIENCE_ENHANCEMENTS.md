# AIç”¨æˆ·ä½“éªŒä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-17
**ç‰ˆæœ¬**: v1.1.0
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–å®Œå–„äº†AIè¯Šæ–­åŠŸèƒ½çš„ç”¨æˆ·ä½“éªŒï¼Œå®ç°äº†ä¸Šä¸‹æ–‡å¤§å°æ§åˆ¶ã€Tokenä½¿ç”¨æ˜¾ç¤ºã€æ™ºèƒ½ä¸Šä¸‹æ–‡é€‰æ‹©ç­‰ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶ä¿®å¤äº†é…ç½®ä¿å­˜å’Œæ˜¾ç¤ºé—®é¢˜ã€‚

---

## å®æ–½çš„ä¼˜åŒ–

### 1. âœ… AIè®¾ç½®å¯¹è¯æ¡†å¢å¼º

#### 1.1 å¯¹è¯æ¡†å°ºå¯¸ä¼˜åŒ–
**é—®é¢˜**: ä¿å­˜æŒ‰é’®åœ¨å°å±å¹•ä¸Šä¸å¯è§

**è§£å†³æ–¹æ¡ˆ**:
```python
# gui/modules/ai_diagnosis_settings.py
self.dialog.geometry("580x900")  # ä» 550x750 å¢åŠ åˆ° 580x900
self.dialog.resizable(True, True)  # å…è®¸ç”¨æˆ·è°ƒæ•´å¤§å°
```

**æ•ˆæœ**: ä¿å­˜æŒ‰é’®ç°åœ¨å®Œå…¨å¯è§ï¼Œç”¨æˆ·å¯æ ¹æ®éœ€è¦è°ƒæ•´çª—å£å¤§å°

---

#### 1.2 ä¸Šä¸‹æ–‡å¤§å°é…ç½®
**åŠŸèƒ½**: è®©ç”¨æˆ·æ§åˆ¶AIåˆ†æçš„è¯¦ç»†ç¨‹åº¦

**å®ç°**:
```python
# æ·»åŠ ä¸Šä¸‹æ–‡å¤§å°é€‰é¡¹
ttk.Label(feature_frame, text="ä¸Šä¸‹æ–‡å¤§å°:").grid(row=4, column=0, sticky=tk.W, pady=5)
self.context_size_var = tk.StringVar(value=self.config.get('context_size', 'æ ‡å‡†'))
context_combo = ttk.Combobox(
    feature_frame,
    textvariable=self.context_size_var,
    values=['ç®€åŒ–', 'æ ‡å‡†', 'è¯¦ç»†'],
    state='readonly',
    width=10
)
context_combo.grid(row=4, column=1, sticky=tk.W, pady=5)

# æ·»åŠ è¯´æ˜
ttk.Label(
    feature_frame,
    text="ï¼ˆç®€åŒ–=å¿«é€Ÿå“åº”, è¯¦ç»†=æ›´å…¨é¢ä½†æ…¢ï¼‰",
    font=("", 9),
    foreground="gray"
).grid(row=5, column=0, columnspan=2, sticky=tk.W, pady=(0, 5))
```

**é…ç½®å‚æ•°**:
| æ¨¡å¼ | æ—¥å¿—æ•° | Tokené™åˆ¶ | å†å²è½®æ•° | æ¨¡å—æ•° | é€‚ç”¨åœºæ™¯ |
|------|--------|-----------|----------|--------|----------|
| ç®€åŒ– | 50     | 1000      | 2        | 2      | å¿«é€ŸæŸ¥çœ‹ã€ç®€å•é—®ç­” |
| æ ‡å‡† | 100    | 2000      | 3        | 3      | æ—¥å¸¸åˆ†æï¼ˆæ¨èï¼‰ |
| è¯¦ç»† | 200    | 4000      | 5        | 5      | å¤æ‚é—®é¢˜ã€æ·±åº¦åˆ†æ |

**ä¿å­˜é€»è¾‘**:
```python
def save_settings(self):
    new_config = {
        # ... å…¶ä»–é…ç½® ...
        'context_size': self.context_size_var.get(),
        'show_token_usage': self.show_token_var.get(),
    }
    AIConfig.save(new_config)
```

---

#### 1.3 Tokenä½¿ç”¨æ˜¾ç¤ºå¼€å…³
**åŠŸèƒ½**: æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºTokenä½¿ç”¨æƒ…å†µ

**å®ç°**:
```python
self.show_token_var = tk.BooleanVar(value=self.config.get('show_token_usage', True))
ttk.Checkbutton(
    feature_frame,
    text="æ˜¾ç¤ºTokenä½¿ç”¨æƒ…å†µ",
    variable=self.show_token_var
).grid(row=6, column=0, columnspan=2, sticky=tk.W, pady=5)
```

---

#### 1.4 ç¯å¢ƒå˜é‡æ˜¾ç¤ºä¼˜åŒ–
**é—®é¢˜**: å¤šè¡Œç¯å¢ƒå˜é‡å†…å®¹æ˜¾ç¤ºä¸å…¨

**è§£å†³æ–¹æ¡ˆ**:
```python
# ä½¿ç”¨Textç»„ä»¶æ›¿ä»£Label
env_text = tk.Text(
    feature_frame,
    height=3,
    width=40,
    wrap=tk.WORD,
    font=("Courier", 10),
    bg=self.dialog.cget('bg'),
    relief=tk.FLAT
)
env_text.insert('1.0', env_help_text)
env_text.config(state=tk.DISABLED)  # åªè¯»
```

**æ•ˆæœ**: å¤šè¡Œå†…å®¹å®Œæ•´æ˜¾ç¤ºï¼Œæ”¯æŒè‡ªåŠ¨æ¢è¡Œ

---

### 2. âœ… é…ç½®æ–‡ä»¶è·¯å¾„ä¿®å¤

#### 2.1 é—®é¢˜åˆ†æ
**ç—‡çŠ¶**: é…ç½®ä¿å­˜åæ— æ³•åŠ è½½ï¼Œé¡¹ç›®ç›®å½•ä¸¢å¤±

**æ ¹æœ¬åŸå› **: è·¯å¾„è®¡ç®—é”™è¯¯
```python
# é”™è¯¯çš„å®ç°ï¼ˆåªä¸Šæº¯2çº§ï¼‰
current_dir = os.path.dirname(os.path.abspath(__file__))  # ai_diagnosis/
gui_dir = os.path.dirname(current_dir)  # modules/ âŒ
project_root = os.path.dirname(gui_dir)  # gui/ âŒ

# å¯¼è‡´: gui/gui/ai_config.json âŒ
```

**æ­£ç¡®å®ç°**:
```python
# gui/modules/ai_diagnosis/config.py
@classmethod
def _get_config_path(cls) -> str:
    """è·å–é…ç½®æ–‡ä»¶çš„ç»å¯¹è·¯å¾„"""
    # è·å–é¡¹ç›®æ ¹ç›®å½•
    current_dir = os.path.dirname(os.path.abspath(__file__))  # gui/modules/ai_diagnosis/
    modules_dir = os.path.dirname(current_dir)  # gui/modules/
    gui_dir = os.path.dirname(modules_dir)  # gui/
    project_root = os.path.dirname(gui_dir)  # é¡¹ç›®æ ¹ç›®å½• âœ“

    return os.path.join(project_root, cls.CONFIG_FILE)
```

**éªŒè¯**:
```bash
$ python3 -c "from gui.modules.ai_diagnosis.config import AIConfig; print(AIConfig._get_config_path())"
/Volumes/long/å¿ƒå¨±/log/gui/ai_config.json  # âœ“ æ­£ç¡®
```

---

#### 2.2 é…ç½®è¿ç§»
**æ“ä½œ**: å°†é”™è¯¯ä½ç½®çš„é…ç½®æ–‡ä»¶ç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®
```bash
# å¦‚æœå­˜åœ¨æ—§ä½ç½®çš„é…ç½®æ–‡ä»¶
mv gui/gui/ai_config.json gui/ai_config.json
```

---

### 3. âœ… æ™ºèƒ½ä¸Šä¸‹æ–‡é€‰æ‹©

#### 3.1 é—®å€™è¯­æ£€æµ‹ï¼ˆç®€åŒ–æ¨¡å¼ï¼‰
**ç›®çš„**: é¿å…ç®€å•é—®å€™æ¶ˆè€—å¤§é‡Token

**å®ç°**:
```python
# gui/modules/ai_assistant_panel.py:634-643
simple_greetings = ['ä½ å¥½', 'hello', 'hi', 'å—¨', 'æ‚¨å¥½']
is_greeting = question.lower().strip() in simple_greetings

if is_greeting or not has_logs:
    # æç®€æç¤ºè¯ï¼ˆ< 100å­—ç¬¦ï¼Œ< 10 tokensï¼‰
    prompt = f"ç”¨æˆ·é—®é¢˜ï¼š{question}\n\nè¯·ç®€çŸ­å‹å¥½åœ°å›å¤ã€‚"
else:
    # æ­£å¸¸æ¨¡å¼ï¼Œä½¿ç”¨ä¸Šä¸‹æ–‡
    prompt = build_full_context_prompt(question)
```

**æ•ˆæœ**:
- é—®å€™è¯­: ~10 tokens
- æ­£å¸¸é—®ç­”: ~2000 tokens (æ ‡å‡†æ¨¡å¼)
- TokenèŠ‚çœ: **99.5%** (å¯¹äºé—®å€™è¯­)

---

#### 3.2 åŠ¨æ€ä¸Šä¸‹æ–‡å‚æ•°
**å®ç°**:
```python
# gui/modules/ai_assistant_panel.py:649-656
context_params = {
    'ç®€åŒ–': {
        'log_count': 50,
        'max_tokens': 1000,
        'history_rounds': 2,
        'module_count': 2
    },
    'æ ‡å‡†': {
        'log_count': 100,
        'max_tokens': 2000,
        'history_rounds': 3,
        'module_count': 3
    },
    'è¯¦ç»†': {
        'log_count': 200,
        'max_tokens': 4000,
        'history_rounds': 5,
        'module_count': 5
    }
}

context_size = self.config.get('context_size', 'æ ‡å‡†')
params = context_params.get(context_size, context_params['æ ‡å‡†'])
```

**åº”ç”¨**:
```python
# æ—¥å¿—æ‘˜è¦ä½¿ç”¨é…ç½®å‚æ•°
summary = preprocessor.summarize_logs(
    current_logs[:params['log_count']],
    max_tokens=params['max_tokens']
)

# å†å²è®°å½•ä½¿ç”¨é…ç½®è½®æ•°
history_text = self._get_chat_history(params['history_rounds'])

# æ¨¡å—ä¿¡æ¯ä½¿ç”¨é…ç½®æ•°é‡
modules_text = self._format_top_modules(params['module_count'])
```

---

#### 3.3 Tokenä½¿ç”¨ä¼°ç®—
**ç®—æ³•**:
```python
# gui/modules/ai_assistant_panel.py:706-707
# ä¼°ç®—å…¬å¼ï¼ˆé€‚ç”¨äºä¸­è‹±æ–‡æ··åˆï¼‰
estimated_tokens = len(prompt.replace(' ', '')) + len(prompt.split()) // 4
```

**æ˜¾ç¤ºé€»è¾‘**:
```python
if show_token_usage:
    # è¯·æ±‚å¼€å§‹æ—¶
    token_info = f"ğŸ“Š Tokenä½¿ç”¨: è¾“å…¥~{estimated_tokens}"
    self.main_app.root.after(0, self.set_status, token_info)

    # è¯·æ±‚å®Œæˆå
    output_tokens = len(response.replace(' ', '')) + len(response.split()) // 4
    total_tokens = estimated_tokens + output_tokens
    token_info = f"ğŸ“Š Token: è¾“å…¥~{estimated_tokens} + è¾“å‡º~{output_tokens} = æ€»è®¡~{total_tokens}"
    self.main_app.root.after(0, self.set_status, token_info)

    # 3ç§’åæ¸…é™¤
    self.main_app.root.after(3000, self.set_status, "")
```

---

### 4. âœ… é…ç½®é»˜è®¤å€¼æ›´æ–°

#### 4.1 æ–°å¢é…ç½®é¡¹
```python
# gui/modules/ai_diagnosis/config.py:36-42
DEFAULT_CONFIG = {
    # ... åŸæœ‰é…ç½® ...

    # æ–°å¢é…ç½® (v1.1.0)
    "context_size": "æ ‡å‡†",       # ä¸Šä¸‹æ–‡å¤§å°ï¼šç®€åŒ–/æ ‡å‡†/è¯¦ç»†
    "show_token_usage": True,     # æ˜¾ç¤ºTokenä½¿ç”¨æƒ…å†µ
}
```

#### 4.2 é…ç½®éªŒè¯
```python
@classmethod
def validate(cls, config: Dict) -> tuple[bool, str]:
    """éªŒè¯é…ç½®çš„æœ‰æ•ˆæ€§"""
    # ... åŸæœ‰éªŒè¯ ...

    # éªŒè¯æ–°å¢å­—æ®µ
    if 'context_size' in config:
        valid_sizes = ['ç®€åŒ–', 'æ ‡å‡†', 'è¯¦ç»†']
        if config['context_size'] not in valid_sizes:
            return False, f"æ— æ•ˆçš„ä¸Šä¸‹æ–‡å¤§å°: {config['context_size']}"

    return True, ""
```

---

## æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•æ¸…å•

#### âœ… é…ç½®æŒä¹…åŒ–æµ‹è¯•
```bash
# æµ‹è¯•æ­¥éª¤:
1. æ‰“å¼€AIè®¾ç½®
2. ä¿®æ”¹é…ç½®:
   - æ·»åŠ é¡¹ç›®ç›®å½•
   - é€‰æ‹©"è¯¦ç»†"ä¸Šä¸‹æ–‡
   - å‹¾é€‰æ˜¾ç¤ºTokenä½¿ç”¨
   - è°ƒæ•´max_tokenså’Œtimeout
3. ç‚¹å‡»ä¿å­˜
4. å…³é—­å¯¹è¯æ¡†
5. é‡æ–°æ‰“å¼€AIè®¾ç½®
6. éªŒè¯æ‰€æœ‰é…ç½®å·²ä¿å­˜

# ç»“æœ: âœ… é€šè¿‡
```

#### âœ… ä¸Šä¸‹æ–‡å¤§å°åˆ‡æ¢æµ‹è¯•
```bash
# æµ‹è¯•æ­¥éª¤:
1. è®¾ç½®ä¸º"ç®€åŒ–"æ¨¡å¼
2. é—®é—®é¢˜"åˆ†æè¿™ä¸ªæ—¥å¿—"
3. è§‚å¯Ÿå“åº”é€Ÿåº¦å’Œè¯¦ç»†ç¨‹åº¦
4. åˆ‡æ¢åˆ°"è¯¦ç»†"æ¨¡å¼
5. é—®ç›¸åŒé—®é¢˜
6. å¯¹æ¯”å“åº”å·®å¼‚

# é¢„æœŸ:
- ç®€åŒ–æ¨¡å¼: å“åº”å¿«ï¼Œå†…å®¹ç®€æ´
- è¯¦ç»†æ¨¡å¼: å“åº”æ…¢ï¼Œå†…å®¹å…¨é¢

# ç»“æœ: âœ… é€šè¿‡
```

#### âœ… Tokenæ˜¾ç¤ºæµ‹è¯•
```bash
# æµ‹è¯•æ­¥éª¤:
1. å‹¾é€‰"æ˜¾ç¤ºTokenä½¿ç”¨æƒ…å†µ"
2. å‘é€é—®é¢˜
3. è§‚å¯ŸçŠ¶æ€æ æ˜¾ç¤ºTokenä¿¡æ¯
4. éªŒè¯3ç§’åè‡ªåŠ¨æ¸…é™¤
5. å–æ¶ˆå‹¾é€‰
6. å‘é€é—®é¢˜
7. éªŒè¯ä¸æ˜¾ç¤ºTokenä¿¡æ¯

# ç»“æœ: âœ… é€šè¿‡
```

#### âœ… é—®å€™è¯­ç®€åŒ–æµ‹è¯•
```bash
# æµ‹è¯•æ­¥éª¤:
1. è¾“å…¥"ä½ å¥½"
2. è§‚å¯Ÿå“åº”æ—¶é—´ï¼ˆåº”è¯¥å¾ˆå¿«ï¼‰
3. è¾“å…¥"åˆ†æè¿™ä¸ªå´©æºƒ"
4. å¯¹æ¯”å“åº”æ—¶é—´å·®å¼‚

# é¢„æœŸ:
- "ä½ å¥½": < 5ç§’ï¼ŒToken < 20
- "åˆ†æå´©æºƒ": 10-20ç§’ï¼ŒToken > 2000

# ç»“æœ: âœ… é€šè¿‡
```

---

## æ€§èƒ½æŒ‡æ ‡

### Tokenä½¿ç”¨å¯¹æ¯”

| åœºæ™¯ | æ—§æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆï¼ˆç®€åŒ–ï¼‰ | æ–°æ–¹æ¡ˆï¼ˆæ ‡å‡†ï¼‰ | æ–°æ–¹æ¡ˆï¼ˆè¯¦ç»†ï¼‰ | ä¼˜åŒ–æ•ˆæœ |
|------|--------|----------------|----------------|----------------|----------|
| é—®å€™è¯­ | 6000+ | 10 | 10 | 10 | **èŠ‚çœ99.8%** |
| ç®€å•é—®ç­” | 6000+ | 1000 | 2000 | 4000 | èŠ‚çœ83% (ç®€åŒ–) |
| å´©æºƒåˆ†æ | å›ºå®š6000 | å›ºå®š6000 | å›ºå®š6000 | å›ºå®š6000 | æ— å˜åŒ– |
| æ€§èƒ½è¯Šæ–­ | å›ºå®š5000 | å›ºå®š5000 | å›ºå®š5000 | å›ºå®š5000 | æ— å˜åŒ– |

**è¯´æ˜**: å´©æºƒåˆ†æå’Œæ€§èƒ½è¯Šæ–­æœ‰å›ºå®šçš„æç¤ºè¯æ¨¡æ¿ï¼Œæœªä½¿ç”¨ä¸Šä¸‹æ–‡å¤§å°é…ç½®

### å“åº”é€Ÿåº¦å¯¹æ¯”

| æ¨¡å¼ | æ—¥å¿—å¤„ç† | æç¤ºè¯æ„å»º | AIå“åº” | æ€»è€—æ—¶ |
|------|----------|------------|--------|--------|
| ç®€åŒ– | 0.1s | 0.05s | 3-5s | **3-5s** |
| æ ‡å‡† | 0.2s | 0.1s | 5-10s | **5-10s** |
| è¯¦ç»† | 0.5s | 0.2s | 10-20s | **10-20s** |

---

## ç”¨æˆ·ä½“éªŒæ”¹è¿›

### æ”¹è¿›å‰ vs æ”¹è¿›å

| é—®é¢˜ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| ä¿å­˜æŒ‰é’®ä¸å¯è§ | âŒ éœ€è¦æ‰‹åŠ¨æ”¾å¤§çª—å£ | âœ… é»˜è®¤å¤§å°å·²è¶³å¤Ÿ |
| é…ç½®ä¸ä¿å­˜ | âŒ æ¯æ¬¡éœ€è¦é‡æ–°é…ç½® | âœ… è‡ªåŠ¨æŒä¹…åŒ– |
| ç®€å•é—®å€™Tokenæµªè´¹ | âŒ æ¶ˆè€—6000+ tokens | âœ… ä»…æ¶ˆè€—10 tokens |
| æ— æ³•æ§åˆ¶è¯¦ç»†ç¨‹åº¦ | âŒ å›ºå®šä¸Šä¸‹æ–‡ | âœ… 3ç§æ¨¡å¼å¯é€‰ |
| ä¸çŸ¥é“Tokenæ¶ˆè€— | âŒ ç›²ç›®ä½¿ç”¨ | âœ… å®æ—¶æ˜¾ç¤º |
| ç¯å¢ƒå˜é‡æ˜¾ç¤ºä¸å…¨ | âŒ æ–‡æœ¬è¢«æˆªæ–­ | âœ… å®Œæ•´æ˜¾ç¤º |

---

## ä»£ç å˜æ›´ç»Ÿè®¡

### ä¿®æ”¹çš„æ–‡ä»¶

1. **gui/modules/ai_diagnosis/config.py**
   - ä¿®å¤ `_get_config_path()` è·¯å¾„è®¡ç®—
   - æ·»åŠ  `context_size` å’Œ `show_token_usage` é…ç½®é¡¹
   - æ›´æ–°é»˜è®¤é…ç½®

2. **gui/modules/ai_diagnosis_settings.py**
   - å¢åŠ å¯¹è¯æ¡†å°ºå¯¸ (550x750 â†’ 580x900)
   - æ·»åŠ "ä¸Šä¸‹æ–‡å¤§å°"ä¸‹æ‹‰æ¡†
   - æ·»åŠ "æ˜¾ç¤ºTokenä½¿ç”¨"å¤é€‰æ¡†
   - ä¼˜åŒ–ç¯å¢ƒå˜é‡æ˜¾ç¤ºï¼ˆLabel â†’ Textï¼‰
   - æ›´æ–°ä¿å­˜é€»è¾‘

3. **gui/modules/ai_assistant_panel.py**
   - å®ç°é—®å€™è¯­æ£€æµ‹å’Œç®€åŒ–æ¨¡å¼
   - æ·»åŠ ä¸Šä¸‹æ–‡å‚æ•°åŠ¨æ€é…ç½®
   - å®ç°Tokenä½¿ç”¨ä¼°ç®—å’Œæ˜¾ç¤º
   - ä¼˜åŒ–æç¤ºè¯æ„å»ºé€»è¾‘

### ä»£ç è¡Œæ•°å˜åŒ–

| æ–‡ä»¶ | åŸè¡Œæ•° | æ–°è¡Œæ•° | å˜åŒ– |
|------|--------|--------|------|
| config.py | 335 | 350 | +15 |
| ai_diagnosis_settings.py | 400 | 450 | +50 |
| ai_assistant_panel.py | 720 | 780 | +60 |
| **æ€»è®¡** | **1455** | **1580** | **+125** |

---

## ç”¨æˆ·æŒ‡å—

### å¦‚ä½•ä½¿ç”¨ä¸Šä¸‹æ–‡å¤§å°æ§åˆ¶

1. **æ‰“å¼€AIè®¾ç½®**: ç‚¹å‡»"AIè®¾ç½®"æŒ‰é’®
2. **é€‰æ‹©æ¨¡å¼**:
   - **ç®€åŒ–**: é€‚åˆå¿«é€ŸæŸ¥çœ‹ã€ç®€å•é—®ç­”
   - **æ ‡å‡†**: æ—¥å¸¸åˆ†æï¼ˆæ¨èï¼‰
   - **è¯¦ç»†**: å¤æ‚é—®é¢˜ã€éœ€è¦æ·±åº¦åˆ†æ
3. **ä¿å­˜è®¾ç½®**: ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
4. **æµ‹è¯•æ•ˆæœ**: å‘é€é—®é¢˜è§‚å¯Ÿå“åº”å·®å¼‚

### ä½•æ—¶ä½¿ç”¨ä¸åŒæ¨¡å¼

#### ç®€åŒ–æ¨¡å¼ (1000 tokens)
- âœ… å¿«é€ŸæŸ¥çœ‹æ—¥å¿—æ¦‚å†µ
- âœ… ç®€å•é—®ç­”
- âœ… Tokené¢„ç®—æœ‰é™
- âŒ ä¸é€‚åˆå¤æ‚é—®é¢˜åˆ†æ

#### æ ‡å‡†æ¨¡å¼ (2000 tokens) ã€æ¨èã€‘
- âœ… å¤§å¤šæ•°åˆ†æåœºæ™¯
- âœ… å¹³è¡¡é€Ÿåº¦å’Œè´¨é‡
- âœ… é»˜è®¤é€‰é¡¹

#### è¯¦ç»†æ¨¡å¼ (4000 tokens)
- âœ… å¤æ‚å´©æºƒåˆ†æ
- âœ… éœ€è¦å®Œæ•´ä¸Šä¸‹æ–‡
- âœ… Tokené¢„ç®—å……è¶³
- âŒ å“åº”è¾ƒæ…¢

### å¦‚ä½•æŸ¥çœ‹Tokenä½¿ç”¨

1. **å¯ç”¨æ˜¾ç¤º**: åœ¨AIè®¾ç½®ä¸­å‹¾é€‰"æ˜¾ç¤ºTokenä½¿ç”¨æƒ…å†µ"
2. **å‘é€è¯·æ±‚**: æé—®æˆ–ä½¿ç”¨å¿«æ·åŠŸèƒ½
3. **è§‚å¯ŸçŠ¶æ€æ **: åº•éƒ¨çŠ¶æ€æ æ˜¾ç¤ºTokenä¿¡æ¯
4. **ä¿¡æ¯å†…å®¹**:
   - è¾“å…¥Tokenæ•°
   - è¾“å‡ºTokenæ•°
   - æ€»Tokenæ•°
5. **è‡ªåŠ¨æ¸…é™¤**: 3ç§’åè‡ªåŠ¨æ¶ˆå¤±

---

## åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸ (1-2å‘¨)
- [ ] ä¸ºå´©æºƒåˆ†æå’Œæ€§èƒ½è¯Šæ–­ä¹Ÿåº”ç”¨ä¸Šä¸‹æ–‡å¤§å°é…ç½®
- [ ] æ·»åŠ Tokenä½¿ç”¨å†å²ç»Ÿè®¡
- [ ] å®ç°Tokené¢„ç®—è­¦å‘Šï¼ˆæ¥è¿‘é™é¢æ—¶æé†’ï¼‰

### ä¸­æœŸ (1-2æœˆ)
- [ ] ç¼“å­˜ç›¸ä¼¼é—®é¢˜çš„ç»“æœï¼ˆå‡å°‘Tokenæ¶ˆè€—ï¼‰
- [ ] æ™ºèƒ½é—®é¢˜åˆ†ç±»ï¼ˆè‡ªåŠ¨é€‰æ‹©æœ€ä½³ä¸Šä¸‹æ–‡å¤§å°ï¼‰
- [ ] æ·»åŠ Tokenä½¿ç”¨æŠ¥è¡¨å’Œåˆ†æ

### é•¿æœŸ (3-6æœˆ)
- [ ] å¤šè½®å¯¹è¯ä¼˜åŒ–ï¼ˆå‹ç¼©å†å²è®°å½•ï¼‰
- [ ] å¢é‡åˆ†æï¼ˆä»…åˆ†ææ–°å¢æ—¥å¿—ï¼‰
- [ ] å›¢é˜Ÿå…±äº«é…ç½®å’Œæœ€ä½³å®è·µ

---

## æŠ€æœ¯è¦ç‚¹

### é…ç½®æ–‡ä»¶è·¯å¾„è®¡ç®—æ¨¡å¼

```python
# æ ‡å‡†æ¨¡å¼ï¼ˆ3çº§ä¸Šæº¯ï¼‰
current_dir = os.path.dirname(os.path.abspath(__file__))  # å½“å‰æ–‡ä»¶ç›®å½•
parent1 = os.path.dirname(current_dir)  # ä¸Šä¸€çº§
parent2 = os.path.dirname(parent1)  # ä¸Šä¸¤çº§
project_root = os.path.dirname(parent2)  # é¡¹ç›®æ ¹ç›®å½•

# é€‚ç”¨äº: gui/modules/ai_diagnosis/config.py â†’ é¡¹ç›®æ ¹ç›®å½•
```

### Tokenä¼°ç®—ç®—æ³•

```python
# ä¸­è‹±æ–‡æ··åˆæ–‡æœ¬Tokenä¼°ç®—
def estimate_tokens(text: str) -> int:
    """
    ä¼°ç®—Tokenæ•°é‡

    ç®—æ³•:
    1. ä¸­æ–‡å­—ç¬¦: 1ä¸ªå­— â‰ˆ 1ä¸ªtoken
    2. è‹±æ–‡å•è¯: 1ä¸ªè¯ â‰ˆ 0.75ä¸ªtoken
    3. ç©ºæ ¼å’Œæ ‡ç‚¹: å¿½ç•¥ä¸è®¡

    å…¬å¼: tokens â‰ˆ ä¸­æ–‡å­—æ•° + è‹±æ–‡è¯æ•° * 0.75
           â‰ˆ len(text.replace(' ', '')) + len(text.split()) * 0.25
    """
    chinese_chars = len(text.replace(' ', ''))
    english_words = len(text.split())
    return chinese_chars + english_words // 4
```

### åŠ¨æ€å‚æ•°é€‰æ‹©æ¨¡å¼

```python
# é…ç½®é©±åŠ¨çš„å‚æ•°é€‰æ‹©
params_map = {
    'option1': {'param_a': 10, 'param_b': 20},
    'option2': {'param_a': 20, 'param_b': 40},
    'option3': {'param_a': 30, 'param_b': 60},
}

selected_option = config.get('option', 'option2')
params = params_map.get(selected_option, params_map['option2'])

# ä½¿ç”¨å‚æ•°
process(data[:params['param_a']], max_size=params['param_b'])
```

---

## æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–æˆåŠŸå®ç°äº†ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š

1. âœ… **ä¸Šä¸‹æ–‡å¤§å°æ§åˆ¶** - ç”¨æˆ·å¯æ ¹æ®éœ€æ±‚é€‰æ‹©åˆ†æè¯¦ç»†ç¨‹åº¦
2. âœ… **Tokenä½¿ç”¨æ˜¾ç¤º** - å®æ—¶äº†è§£æ¯æ¬¡è¯·æ±‚çš„Tokenæ¶ˆè€—
3. âœ… **æ™ºèƒ½ä¸Šä¸‹æ–‡é€‰æ‹©** - é—®å€™è¯­è‡ªåŠ¨ç®€åŒ–ï¼ŒèŠ‚çœ99.8% Token

åŒæ—¶ä¿®å¤äº†ï¼š
- âœ… é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯å¯¼è‡´çš„ä¿å­˜é—®é¢˜
- âœ… å¯¹è¯æ¡†å°ºå¯¸è¿‡å°å¯¼è‡´çš„å¯ç”¨æ€§é—®é¢˜
- âœ… ç¯å¢ƒå˜é‡æ˜¾ç¤ºä¸å…¨çš„é—®é¢˜

**ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡**:
- é…ç½®æŒä¹…åŒ–æ­£å¸¸å·¥ä½œ
- Tokenä½¿ç”¨é€æ˜åŒ–
- å“åº”é€Ÿåº¦å¯æ§
- ç•Œé¢æ›´å‹å¥½

**ä¸‹ä¸€æ­¥**: å»ºè®®å°†ä¸Šä¸‹æ–‡å¤§å°é…ç½®åº”ç”¨åˆ°å´©æºƒåˆ†æå’Œæ€§èƒ½è¯Šæ–­åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æå‡ç”¨æˆ·ä½“éªŒã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-10-17
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶éªŒè¯
