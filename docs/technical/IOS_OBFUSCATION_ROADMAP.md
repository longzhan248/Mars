# iOSæ··æ·†åŠŸèƒ½åç»­å¼€å‘å’Œä¼˜åŒ–è®¡åˆ’

## æ–‡æ¡£ä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-14
**é€‚ç”¨ç‰ˆæœ¬**: v2.2.0+
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ

---

## æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’äº†iOSä»£ç æ··æ·†åŠŸèƒ½çš„åç»­å¼€å‘å’Œä¼˜åŒ–è·¯å¾„ã€‚å½“å‰å·²å®Œæˆæ ¸å¿ƒæ··æ·†å¼•æ“ã€ä»£ç è§£æ/è½¬æ¢ã€P2é«˜çº§èµ„æºå¤„ç†ç­‰åŠŸèƒ½ï¼ˆv2.2.0ï¼‰ã€‚åç»­å°†èšç„¦äº**æ€§èƒ½ä¼˜åŒ–**ã€**åŠŸèƒ½å¢å¼º**ã€**ç”¨æˆ·ä½“éªŒæ”¹è¿›**å’Œ**ä¼ä¸šçº§ç‰¹æ€§**å››å¤§æ–¹å‘ã€‚

### å½“å‰çŠ¶æ€ï¼ˆv2.2.0ï¼‰

âœ… **å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
- å®Œæ•´çš„æ··æ·†å¼•æ“ï¼ˆ9ä¸ªæ ¸å¿ƒæ¨¡å—ï¼‰
- ä»£ç è§£æå’Œè½¬æ¢ï¼ˆObjC/Swiftå®Œæ•´æ”¯æŒï¼‰
- åŸºç¡€èµ„æºå¤„ç†ï¼ˆXIB/Storyboard/å›¾ç‰‡hashï¼‰
- P2é«˜çº§èµ„æºå¤„ç†ï¼ˆAssets/å›¾ç‰‡åƒç´ /éŸ³é¢‘/å­—ä½“ï¼‰
- åƒåœ¾ä»£ç ç”Ÿæˆå™¨
- å­—ç¬¦ä¸²åŠ å¯†å™¨
- å¢é‡ç¼–è¯‘ç®¡ç†å™¨
- GUIç•Œé¢å’ŒCLIå·¥å…·

ğŸ“Š **ä»£ç è§„æ¨¡ç»Ÿè®¡**ï¼š
- æ€»ä»£ç é‡ï¼šçº¦12,000è¡Œ
- æ ¸å¿ƒæ¨¡å—ï¼š15ä¸ª
- æµ‹è¯•ç”¨ä¾‹ï¼š80+ä¸ª
- æ–‡æ¡£è§„æ¨¡ï¼š200+ KB

---

## å¼€å‘è·¯å¾„è§„åˆ’

```
v2.2.0 (å½“å‰ç‰ˆæœ¬)
    â”‚
    â”œâ”€ v2.3.0 (æ€§èƒ½ä¼˜åŒ–)         [é¢„è®¡ï¼š2å‘¨]
    â”‚   â”œâ”€ å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†
    â”‚   â”œâ”€ å¤§æ–‡ä»¶æµå¼å¤„ç†
    â”‚   â”œâ”€ å†…å­˜ä¼˜åŒ–
    â”‚   â””â”€ ç¼“å­˜æœºåˆ¶
    â”‚
    â”œâ”€ v2.4.0 (åŠŸèƒ½å¢å¼º)         [é¢„è®¡ï¼š3å‘¨]
    â”‚   â”œâ”€ Swiftæ³›å‹å®Œæ•´æ”¯æŒ
    â”‚   â”œâ”€ ObjC++ æ··åˆè¯­æ³•
    â”‚   â”œâ”€ æ–¹æ³•é‡è½½/é‡å†™å¤„ç†
    â”‚   â””â”€ Blockå’Œé—­åŒ…æ··æ·†
    â”‚
    â”œâ”€ v2.5.0 (ä½“éªŒä¼˜åŒ–)         [é¢„è®¡ï¼š2å‘¨]
    â”‚   â”œâ”€ GUIç•Œé¢æ”¹è¿›
    â”‚   â”œâ”€ é…ç½®é¢„è®¾ç®¡ç†
    â”‚   â”œâ”€ å®æ—¶é¢„è§ˆ
    â”‚   â””â”€ æ··æ·†å‰åå¯¹æ¯”
    â”‚
    â””â”€ v3.0.0 (ä¼ä¸šçº§)           [é¢„è®¡ï¼š4å‘¨]
        â”œâ”€ å›¢é˜Ÿåä½œæ”¯æŒ
        â”œâ”€ äº‘ç«¯é…ç½®åŒæ­¥
        â”œâ”€ æ··æ·†æ•ˆæœè¯„ä¼°
        â””â”€ å®‰å…¨å®¡è®¡æ—¥å¿—
```

---

## ä¼˜å…ˆçº§ä¸€ï¼šæ€§èƒ½ä¼˜åŒ– (v2.3.0) ğŸš€

### ç›®æ ‡
å°†å¤§å‹é¡¹ç›®ï¼ˆ10ä¸‡è¡Œ+ä»£ç ï¼‰çš„æ··æ·†æ—¶é—´ä»**åˆ†é’Ÿçº§**ä¼˜åŒ–åˆ°**ç§’çº§**ï¼Œå†…å­˜å ç”¨é™ä½50%ã€‚

### 1. å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†

#### ç°çŠ¶åˆ†æ
å½“å‰å®ç°ä½¿ç”¨å•çº¿ç¨‹é¡ºåºå¤„ç†æ‰€æœ‰æ–‡ä»¶ï¼š
```python
# å½“å‰ä»£ç ï¼ˆobfuscation_engine.py:286ï¼‰
for file in source_files:
    symbols = parser.parse_file(file.path)
    transformed_code = transformer.transform(file.path, symbols)
```

**é—®é¢˜**ï¼š
- CPUåˆ©ç”¨ç‡ä½ï¼ˆå•æ ¸å ç”¨ï¼‰
- I/Oé˜»å¡æ—¶CPUç©ºé—²
- å¤§é¡¹ç›®å¤„ç†æ—¶é—´é•¿

#### ä¼˜åŒ–æ–¹æ¡ˆ

##### 1.1 çº¿ç¨‹æ± å¹¶è¡Œè§£æ
```python
# æ–°å¢ï¼šparallel_parser.py
from concurrent.futures import ThreadPoolExecutor, as_completed
import multiprocessing

class ParallelCodeParser:
    """å¹¶è¡Œä»£ç è§£æå™¨"""

    def __init__(self, max_workers: int = None):
        """
        Args:
            max_workers: æœ€å¤§çº¿ç¨‹æ•°ï¼Œé»˜è®¤ä¸ºCPUæ ¸å¿ƒæ•°
        """
        self.max_workers = max_workers or multiprocessing.cpu_count()

    def parse_files_parallel(self,
                           file_paths: List[str],
                           parser: CodeParser,
                           callback: Optional[Callable] = None) -> Dict[str, ParsedFile]:
        """
        å¹¶è¡Œè§£ææ–‡ä»¶

        æ€§èƒ½æå‡ï¼š
        - å°é¡¹ç›®ï¼ˆ<100æ–‡ä»¶ï¼‰ï¼š2-3å€
        - ä¸­é¡¹ç›®ï¼ˆ100-500æ–‡ä»¶ï¼‰ï¼š3-5å€
        - å¤§é¡¹ç›®ï¼ˆ>500æ–‡ä»¶ï¼‰ï¼š5-8å€
        """
        parsed_files = {}
        total = len(file_paths)

        with ThreadPoolExecutor(max_workers=self.max_workers) as executor:
            # æäº¤æ‰€æœ‰ä»»åŠ¡
            future_to_path = {
                executor.submit(parser.parse_file, path): path
                for path in file_paths
            }

            # æ”¶é›†ç»“æœ
            for i, future in enumerate(as_completed(future_to_path), 1):
                path = future_to_path[future]
                try:
                    parsed_files[path] = future.result()
                    if callback:
                        callback(i / total, f"è§£æ: {Path(path).name}")
                except Exception as e:
                    print(f"è§£æå¤±è´¥ {path}: {e}")

        return parsed_files
```

##### 1.2 è¿›ç¨‹æ± å¤„ç†å¤§æ–‡ä»¶
å¯¹äºè¶…å¤§æ–‡ä»¶ï¼ˆ>5000è¡Œï¼‰ï¼Œä½¿ç”¨è¿›ç¨‹æ± é¿å…GILé™åˆ¶ï¼š

```python
# æ–°å¢ï¼šmultiprocess_transformer.py
from concurrent.futures import ProcessPoolExecutor

def transform_file_worker(args):
    """è¿›ç¨‹å·¥ä½œå‡½æ•°ï¼ˆåºåˆ—åŒ–å‹å¥½ï¼‰"""
    file_path, symbols, mappings, whitelist_data = args

    # é‡æ–°åˆ›å»ºå¯¹è±¡ï¼ˆè¿›ç¨‹é—´ä¸å…±äº«ï¼‰
    transformer = CodeTransformer(None, None)
    transformer.symbol_mappings = mappings

    return file_path, transformer.transform_file(file_path, symbols)


class MultiProcessTransformer:
    """å¤šè¿›ç¨‹ä»£ç è½¬æ¢å™¨"""

    def transform_large_files(self,
                            files: Dict[str, ParsedFile],
                            mappings: Dict[str, str],
                            max_workers: int = 4) -> Dict[str, TransformResult]:
        """
        å¤šè¿›ç¨‹è½¬æ¢å¤§æ–‡ä»¶

        é€‚ç”¨åœºæ™¯ï¼š
        - å•æ–‡ä»¶ > 5000 è¡Œ
        - æ€»è¡Œæ•° > 50000 è¡Œ
        """
        args_list = [
            (path, parsed.symbols, mappings, whitelist)
            for path, parsed in files.items()
        ]

        results = {}
        with ProcessPoolExecutor(max_workers=max_workers) as executor:
            for file_path, result in executor.map(transform_file_worker, args_list):
                results[file_path] = result

        return results
```

##### 1.3 é›†æˆåˆ°å¼•æ“
ä¿®æ”¹ `obfuscation_engine.py`ï¼š

```python
def _parse_source_files(self, progress_callback=None):
    """è§£ææºæ–‡ä»¶ï¼ˆå¹¶è¡Œä¼˜åŒ–ï¼‰"""
    # ... ç°æœ‰ä»£ç  ...

    # å†³ç­–ï¼šä½¿ç”¨å¹¶è¡Œè¿˜æ˜¯ä¸²è¡Œ
    if len(files_to_parse) > 10:
        # ä½¿ç”¨å¹¶è¡Œè§£æ
        parallel_parser = ParallelCodeParser(max_workers=8)
        self.parsed_files = parallel_parser.parse_files_parallel(
            files_to_parse,
            self.code_parser,
            callback=parser_callback
        )
    else:
        # å°‘é‡æ–‡ä»¶ï¼Œä¸²è¡Œæ›´å¿«ï¼ˆé¿å…çº¿ç¨‹å¼€é”€ï¼‰
        self.parsed_files = self.code_parser.parse_files(
            files_to_parse,
            callback=parser_callback
        )

def _transform_code(self, progress_callback=None):
    """è½¬æ¢ä»£ç ï¼ˆå¤šè¿›ç¨‹ä¼˜åŒ–ï¼‰"""
    total_lines = sum(f.total_lines for f in self.parsed_files.values())

    if total_lines > 50000:
        # ä½¿ç”¨å¤šè¿›ç¨‹
        mp_transformer = MultiProcessTransformer()
        self.transform_results = mp_transformer.transform_large_files(
            self.parsed_files,
            self.name_generator.get_all_mappings(),
            max_workers=4
        )
    else:
        # ä½¿ç”¨çº¿ç¨‹æ± 
        # ... ç°æœ‰é€»è¾‘ ...
```

**é¢„æœŸæ•ˆæœ**ï¼š
- 100ä¸ªæ–‡ä»¶é¡¹ç›®ï¼šä»60ç§’é™è‡³15ç§’ï¼ˆ4å€æå‡ï¼‰
- 500ä¸ªæ–‡ä»¶é¡¹ç›®ï¼šä»5åˆ†é’Ÿé™è‡³1åˆ†é’Ÿï¼ˆ5å€æå‡ï¼‰

---

### 2. å¤§æ–‡ä»¶æµå¼å¤„ç†

#### ç°çŠ¶åˆ†æ
å½“å‰å®ç°ä¸€æ¬¡æ€§è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜ï¼š
```python
# code_parser.py:150
with open(file_path, 'r', encoding='utf-8') as f:
    content = f.read()  # ä¸€æ¬¡æ€§è¯»å–
```

**é—®é¢˜**ï¼š
- 100MB+æ–‡ä»¶å¯¼è‡´å†…å­˜å³°å€¼
- å¯èƒ½è§¦å‘OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰

#### ä¼˜åŒ–æ–¹æ¡ˆ

##### 2.1 åˆ†å—æµå¼è¯»å–
```python
# æ–°å¢ï¼šstream_parser.py
class StreamCodeParser:
    """æµå¼ä»£ç è§£æå™¨"""

    CHUNK_SIZE = 10000  # æ¯æ¬¡è¯»å–10000è¡Œ

    def parse_file_stream(self, file_path: str) -> ParsedFile:
        """
        æµå¼è§£æå¤§æ–‡ä»¶

        å†…å­˜ä¼˜åŒ–ï¼š
        - åŸæ–¹æ¡ˆï¼š100MBæ–‡ä»¶å ç”¨100MBå†…å­˜
        - æ–°æ–¹æ¡ˆï¼š100MBæ–‡ä»¶å ç”¨<10MBå†…å­˜ï¼ˆå³°å€¼ï¼‰
        """
        symbols = {
            'classes': [],
            'methods': [],
            'properties': [],
            # ...
        }

        line_buffer = []
        in_multiline_comment = False
        current_class = None

        with open(file_path, 'r', encoding='utf-8') as f:
            for line_num, line in enumerate(f, 1):
                line_buffer.append(line)

                # æ¯CHUNK_SIZEè¡Œå¤„ç†ä¸€æ¬¡
                if len(line_buffer) >= self.CHUNK_SIZE:
                    self._parse_chunk(line_buffer, symbols, in_multiline_comment, current_class)
                    line_buffer = []

            # å¤„ç†å‰©ä½™å†…å®¹
            if line_buffer:
                self._parse_chunk(line_buffer, symbols, in_multiline_comment, current_class)

        return ParsedFile(file_path, symbols)

    def _parse_chunk(self, lines, symbols, in_comment, current_class):
        """è§£æä»£ç å—"""
        for line in lines:
            # è§£æé€»è¾‘ï¼ˆä¿æŒçŠ¶æ€è·¨å—ï¼‰
            pass
```

##### 2.2 å†…å­˜æ˜ å°„æ–‡ä»¶
å¯¹äºè¶…å¤§æ–‡ä»¶ï¼ˆ>500MBï¼‰ï¼Œä½¿ç”¨mmapï¼š

```python
import mmap

def parse_with_mmap(file_path: str) -> ParsedFile:
    """ä½¿ç”¨å†…å­˜æ˜ å°„è§£æè¶…å¤§æ–‡ä»¶"""
    with open(file_path, 'r+b') as f:
        with mmap.mmap(f.fileno(), 0, access=mmap.ACCESS_READ) as mmapped_file:
            # ç›´æ¥åœ¨æ˜ å°„å†…å­˜ä¸Šæ“ä½œ
            content = mmapped_file.read()
            # è§£æé€»è¾‘...
```

**é¢„æœŸæ•ˆæœ**ï¼š
- å†…å­˜å ç”¨é™ä½80%
- æ”¯æŒGBçº§æ–‡ä»¶è§£æ

---

### 3. ç¼“å­˜æœºåˆ¶ä¼˜åŒ–

#### ä¼˜åŒ–æ–¹æ¡ˆ

##### 3.1 è§£æç»“æœç¼“å­˜
```python
# æ–°å¢ï¼šparser_cache.py
import hashlib
import pickle

class ParseResultCache:
    """è§£æç»“æœç¼“å­˜"""

    def __init__(self, cache_dir=".obfuscation_cache"):
        self.cache_dir = Path(cache_dir)
        self.cache_dir.mkdir(exist_ok=True)

    def get_file_hash(self, file_path: str) -> str:
        """è®¡ç®—æ–‡ä»¶MD5"""
        with open(file_path, 'rb') as f:
            return hashlib.md5(f.read()).hexdigest()

    def get_cached_result(self, file_path: str) -> Optional[ParsedFile]:
        """è·å–ç¼“å­˜çš„è§£æç»“æœ"""
        file_hash = self.get_file_hash(file_path)
        cache_file = self.cache_dir / f"{file_hash}.pkl"

        if cache_file.exists():
            with open(cache_file, 'rb') as f:
                return pickle.load(f)

        return None

    def save_result(self, file_path: str, result: ParsedFile):
        """ä¿å­˜è§£æç»“æœ"""
        file_hash = self.get_file_hash(file_path)
        cache_file = self.cache_dir / f"{file_hash}.pkl"

        with open(cache_file, 'wb') as f:
            pickle.dump(result, f)
```

é›†æˆåˆ° `code_parser.py`ï¼š
```python
def parse_file(self, file_path: str) -> ParsedFile:
    """è§£ææ–‡ä»¶ï¼ˆå¸¦ç¼“å­˜ï¼‰"""
    # æ£€æŸ¥ç¼“å­˜
    cached = self.cache.get_cached_result(file_path)
    if cached:
        return cached

    # è§£ææ–‡ä»¶
    result = self._parse_file_impl(file_path)

    # ä¿å­˜ç¼“å­˜
    self.cache.save_result(file_path, result)

    return result
```

**é¢„æœŸæ•ˆæœ**ï¼š
- é‡å¤è§£æé€Ÿåº¦æå‡100å€ï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰
- å¢é‡æ„å»ºæ—¶é—´å¤§å¹…å‡å°‘

---

### 4. æ€§èƒ½ç›‘æ§å’Œåˆ†æ

#### æ–°å¢å·¥å…·

##### 4.1 æ€§èƒ½åˆ†æå™¨
```python
# æ–°å¢ï¼šperformance_profiler.py
import time
import tracemalloc
from functools import wraps

class PerformanceProfiler:
    """æ€§èƒ½åˆ†æå™¨"""

    def __init__(self):
        self.metrics = {}

    def profile(self, name):
        """æ€§èƒ½åˆ†æè£…é¥°å™¨"""
        def decorator(func):
            @wraps(func)
            def wrapper(*args, **kwargs):
                # å¼€å§‹è¿½è¸ª
                tracemalloc.start()
                start_time = time.time()

                # æ‰§è¡Œå‡½æ•°
                result = func(*args, **kwargs)

                # æ”¶é›†æŒ‡æ ‡
                elapsed = time.time() - start_time
                current, peak = tracemalloc.get_traced_memory()
                tracemalloc.stop()

                self.metrics[name] = {
                    'elapsed_time': elapsed,
                    'memory_current': current / 1024 / 1024,  # MB
                    'memory_peak': peak / 1024 / 1024,  # MB
                }

                return result
            return wrapper
        return decorator

    def print_report(self):
        """æ‰“å°æ€§èƒ½æŠ¥å‘Š"""
        print("\n" + "="*60)
        print("æ€§èƒ½åˆ†ææŠ¥å‘Š")
        print("="*60)

        for name, metrics in self.metrics.items():
            print(f"\n{name}:")
            print(f"  è€—æ—¶: {metrics['elapsed_time']:.2f}ç§’")
            print(f"  å†…å­˜ï¼ˆå½“å‰ï¼‰: {metrics['memory_current']:.2f} MB")
            print(f"  å†…å­˜ï¼ˆå³°å€¼ï¼‰: {metrics['memory_peak']:.2f} MB")
```

##### 4.2 ä½¿ç”¨ç¤ºä¾‹
```python
profiler = PerformanceProfiler()

@profiler.profile("é¡¹ç›®åˆ†æ")
def analyze_project():
    # ...

@profiler.profile("ä»£ç è§£æ")
def parse_files():
    # ...

# æ‰§è¡Œæ··æ·†
result = engine.obfuscate(project_path, output_dir)

# æ‰“å°æŠ¥å‘Š
profiler.print_report()
```

---

### æ€§èƒ½ä¼˜åŒ–æ€»ç»“

| ä¼˜åŒ–é¡¹ | å½“å‰æ€§èƒ½ | ç›®æ ‡æ€§èƒ½ | æå‡å€æ•° |
|--------|---------|---------|---------|
| å°é¡¹ç›®ï¼ˆ<100æ–‡ä»¶ï¼‰ | 10ç§’ | 3ç§’ | 3å€ |
| ä¸­é¡¹ç›®ï¼ˆ100-500æ–‡ä»¶ï¼‰ | 60ç§’ | 12ç§’ | 5å€ |
| å¤§é¡¹ç›®ï¼ˆ>500æ–‡ä»¶ï¼‰ | 300ç§’ | 50ç§’ | 6å€ |
| å†…å­˜å ç”¨ | 500MB | 250MB | 50%â†“ |
| é‡å¤æ„å»º | 300ç§’ | 3ç§’ | 100å€ |

**å®æ–½ä¼˜å…ˆçº§**ï¼š
1. ğŸ”´ P0ï¼šå¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†ï¼ˆ2å¤©ï¼‰
2. ğŸŸ¡ P1ï¼šç¼“å­˜æœºåˆ¶ï¼ˆ1å¤©ï¼‰
3. ğŸŸ¢ P2ï¼šæµå¼å¤„ç†ï¼ˆ2å¤©ï¼‰
4. ğŸ”µ P3ï¼šæ€§èƒ½ç›‘æ§ï¼ˆ1å¤©ï¼‰

---

## ä¼˜å…ˆçº§äºŒï¼šåŠŸèƒ½å¢å¼º (v2.4.0) ğŸ¯

### 1. Swifté«˜çº§ç‰¹æ€§æ”¯æŒ

#### 1.1 æ³›å‹å®Œæ•´æ”¯æŒ

**å½“å‰é™åˆ¶**ï¼š
```swift
// ç®€å•æ³›å‹å¯ä»¥å¤„ç†
class Box<T> { }

// å¤æ‚æ³›å‹æ— æ³•å¤„ç†
class Cache<Key: Hashable, Value> where Key: Comparable { }
```

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```python
# å¢å¼ºï¼šcode_parser.py - Swiftæ³›å‹è§£æ
class SwiftGenericParser:
    """Swiftæ³›å‹è§£æå™¨"""

    def parse_generic_clause(self, declaration: str) -> Dict:
        """
        è§£ææ³›å‹å­å¥

        æ”¯æŒï¼š
        - ç®€å•æ³›å‹ï¼š<T>
        - çº¦æŸæ³›å‹ï¼š<T: Protocol>
        - å¤šçº¦æŸï¼š<T: P1 & P2>
        - whereå­å¥ï¼šwhere T: Comparable
        """
        # æå–æ³›å‹å‚æ•°
        generic_params = self._extract_generic_params(declaration)

        # æå–ç±»å‹çº¦æŸ
        constraints = self._extract_constraints(declaration)

        # æå–whereå­å¥
        where_clause = self._extract_where_clause(declaration)

        return {
            'params': generic_params,
            'constraints': constraints,
            'where': where_clause
        }

    def should_obfuscate_generic_type(self, type_name: str) -> bool:
        """åˆ¤æ–­æ³›å‹ç±»å‹æ˜¯å¦åº”æ··æ·†"""
        # ç³»ç»Ÿç±»å‹ä¸æ··æ·†
        if type_name in ['Array', 'Dictionary', 'Set', 'Optional']:
            return False

        # è‡ªå®šä¹‰ç±»å‹æ··æ·†
        return True
```

**æ··æ·†ç­–ç•¥**ï¼š
```python
def obfuscate_generic_class(self, class_decl: str) -> str:
    """
    æ··æ·†æ³›å‹ç±»

    åŸå§‹ï¼š
    class RequestManager<T: Decodable, E: Error> { }

    æ··æ·†åï¼š
    class WHC_A1B2<T: Decodable, E: Error> { }

    æ³¨æ„ï¼š
    - ç±»åæ··æ·†
    - æ³›å‹å‚æ•°åä¸æ··æ·†ï¼ˆä¿æŒå¯è¯»æ€§ï¼‰
    - çº¦æŸä¸å˜
    """
    pass
```

#### 1.2 åè®®æ‰©å±•ï¼ˆProtocol Extensionï¼‰

**å½“å‰é—®é¢˜**ï¼š
```swift
// åè®®æ‰©å±•ä¸­çš„æ–¹æ³•æœªè¢«è¯†åˆ«
extension Collection where Element: Comparable {
    func customSort() -> [Element] {
        // ...
    }
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def parse_protocol_extension(self, code: str) -> List[Dict]:
    """
    è§£æåè®®æ‰©å±•

    è¯†åˆ«ï¼š
    - extension å…³é”®å­—
    - where å­å¥
    - æ‰©å±•æ–¹æ³•
    """
    extensions = []

    pattern = r'extension\s+(\w+)(?:\s+where\s+(.+?))?\s*\{'
    matches = re.finditer(pattern, code)

    for match in matches:
        protocol_name = match.group(1)
        where_clause = match.group(2)

        # æå–æ‰©å±•ä¸­çš„æ–¹æ³•
        methods = self._parse_methods_in_extension(match.end(), code)

        extensions.append({
            'protocol': protocol_name,
            'where': where_clause,
            'methods': methods
        })

    return extensions
```

---

### 2. Objective-C++ æ··åˆè¯­æ³•

#### é—®é¢˜åœºæ™¯
```objc
// .mm æ–‡ä»¶ä¸­çš„C++ä»£ç 
#import "MyClass.h"

class CppHelper {  // C++ ç±»
public:
    void process() {
        // C++ é€»è¾‘
    }
};

@implementation MyClass

- (void)useHelper {
    CppHelper helper;
    helper.process();
}

@end
```

#### è§£å†³æ–¹æ¡ˆ

##### 2.1 æ··åˆè¯­æ³•è¯†åˆ«
```python
# æ–°å¢ï¼šobjcpp_parser.py
class ObjCppMixedParser:
    """Objective-C++ æ··åˆè§£æå™¨"""

    def parse_mm_file(self, file_path: str) -> ParsedFile:
        """è§£æ.mmæ–‡ä»¶"""
        with open(file_path, 'r') as f:
            content = f.read()

        # åˆ†ç¦»C++å’ŒObjCä»£ç æ®µ
        cpp_segments = self._extract_cpp_segments(content)
        objc_segments = self._extract_objc_segments(content)

        # åˆ†åˆ«è§£æ
        cpp_symbols = self._parse_cpp_symbols(cpp_segments)
        objc_symbols = self._parse_objc_symbols(objc_segments)

        # åˆå¹¶ç¬¦å·
        return ParsedFile(
            file_path,
            symbols={
                'cpp': cpp_symbols,
                'objc': objc_symbols
            }
        )

    def _extract_cpp_segments(self, content: str) -> List[str]:
        """æå–C++ä»£ç æ®µ"""
        segments = []

        # è¯†åˆ«C++ç‰¹å¾
        cpp_patterns = [
            r'class\s+\w+\s*{',  # C++ class
            r'namespace\s+\w+\s*{',  # namespace
            r'template\s*<',  # template
        ]

        # ... æå–é€»è¾‘
        return segments
```

##### 2.2 æ··æ·†ç­–ç•¥
```python
def transform_objcpp_file(self, file_path: str) -> TransformResult:
    """
    æ··æ·†ObjC++æ–‡ä»¶

    ç­–ç•¥ï¼š
    - C++éƒ¨åˆ†ï¼šå¯é€‰æ‹©ä¸æ··æ·†ï¼ˆé¿å…å¤æ‚åº¦ï¼‰
    - ObjCéƒ¨åˆ†ï¼šæ­£å¸¸æ··æ·†
    - äº¤äº’è¾¹ç•Œï¼šä¿æŒåç§°ä¸€è‡´
    """
    cpp_mappings = self._generate_cpp_mappings()
    objc_mappings = self._generate_objc_mappings()

    # ç¡®ä¿è¾¹ç•Œæ–¹æ³•åç§°åŒ¹é…
    self._sync_boundary_methods(cpp_mappings, objc_mappings)

    # è½¬æ¢ä»£ç 
    return self._apply_transformations(file_path, cpp_mappings, objc_mappings)
```

---

### 3. æ–¹æ³•é‡è½½å’Œé‡å†™å¤„ç†

#### é—®é¢˜åœºæ™¯
```objc
// åŸºç±»
@interface Animal
- (void)eat;
- (void)eat:(NSString *)food;  // é‡è½½
@end

// å­ç±»
@interface Dog : Animal
- (void)eat;  // é‡å†™
@end
```

**å½“å‰é—®é¢˜**ï¼šæ··æ·†åå¯èƒ½ç ´åç»§æ‰¿å…³ç³»ã€‚

#### è§£å†³æ–¹æ¡ˆ

##### 3.1 ç»§æ‰¿å…³ç³»è¿½è¸ª
```python
# å¢å¼ºï¼šcode_parser.py
class InheritanceTracker:
    """ç»§æ‰¿å…³ç³»è¿½è¸ªå™¨"""

    def __init__(self):
        self.hierarchy = {}  # {å­ç±»: çˆ¶ç±»}
        self.overrides = {}  # {å­ç±»: {æ–¹æ³•: çˆ¶ç±»æ–¹æ³•}}

    def build_hierarchy(self, parsed_files: Dict[str, ParsedFile]):
        """æ„å»ºç»§æ‰¿å±‚æ¬¡"""
        for file_path, parsed in parsed_files.items():
            for cls in parsed.symbols['classes']:
                if cls['superclass']:
                    self.hierarchy[cls['name']] = cls['superclass']

    def find_overridden_methods(self, class_name: str, method_name: str) -> List[str]:
        """
        æŸ¥æ‰¾é‡å†™çš„æ–¹æ³•

        è¿”å›ï¼šæ‰€æœ‰çˆ¶ç±»ä¸­åŒåæ–¹æ³•åˆ—è¡¨
        """
        overridden = []
        current = self.hierarchy.get(class_name)

        while current:
            # æ£€æŸ¥çˆ¶ç±»æ˜¯å¦æœ‰æ­¤æ–¹æ³•
            if self._has_method(current, method_name):
                overridden.append(current)

            current = self.hierarchy.get(current)

        return overridden
```

##### 3.2 ä¸€è‡´æ€§æ··æ·†
```python
def obfuscate_with_inheritance(self, classes: List[Dict]) -> Dict[str, str]:
    """
    è€ƒè™‘ç»§æ‰¿å…³ç³»çš„æ··æ·†

    è§„åˆ™ï¼š
    - é‡å†™æ–¹æ³•ä½¿ç”¨ç›¸åŒæ··æ·†å
    - é‡è½½æ–¹æ³•ä¿æŒå‚æ•°ç­¾å
    - åè®®æ–¹æ³•ä¸æ··æ·†æˆ–ç»Ÿä¸€æ··æ·†
    """
    mappings = {}

    for cls in classes:
        for method in cls['methods']:
            # æŸ¥æ‰¾æ˜¯å¦é‡å†™çˆ¶ç±»æ–¹æ³•
            overridden = self.tracker.find_overridden_methods(
                cls['name'],
                method['name']
            )

            if overridden:
                # ä½¿ç”¨çˆ¶ç±»æ–¹æ³•çš„æ··æ·†å
                base_class = overridden[0]
                base_method = self._get_method(base_class, method['name'])
                obfuscated = mappings.get(f"{base_class}.{base_method}")
            else:
                # ç”Ÿæˆæ–°æ··æ·†å
                obfuscated = self.generator.generate(method['name'], 'method')

            mappings[f"{cls['name']}.{method['name']}"] = obfuscated

    return mappings
```

---

### 4. Blockå’Œé—­åŒ…æ··æ·†

#### é—®é¢˜åœºæ™¯
```objc
// Blockå®šä¹‰
typedef void (^CompletionBlock)(BOOL success, NSError *error);

// Blockä½œä¸ºå‚æ•°
- (void)loadData:(CompletionBlock)completion {
    completion(YES, nil);
}

// è°ƒç”¨
[self loadData:^(BOOL success, NSError *error) {
    // ...
}];
```

#### è§£å†³æ–¹æ¡ˆ

##### 4.1 Blockç±»å‹è¯†åˆ«
```python
def parse_block_types(self, code: str) -> List[Dict]:
    """
    è¯†åˆ«Blockç±»å‹å®šä¹‰

    æ”¯æŒï¼š
    - typedef Block
    - @property Block
    - å‚æ•°Block
    - è¿”å›å€¼Block
    """
    block_types = []

    # typedef Block
    pattern = r'typedef\s+.+?\s*\(\s*\^\s*(\w+)\s*\)\s*\([^)]*\)'
    matches = re.finditer(pattern, code)

    for match in matches:
        block_types.append({
            'name': match.group(1),
            'type': 'typedef',
            'definition': match.group(0)
        })

    return block_types
```

##### 4.2 Blockæ··æ·†ç­–ç•¥
```python
def obfuscate_blocks(self, blocks: List[Dict]) -> Dict[str, str]:
    """
    æ··æ·†Block

    ç­–ç•¥ï¼š
    - typedef Blockåç§°ï¼šæ··æ·†
    - Blockå‚æ•°åï¼šå¯é€‰æ··æ·†
    - å†…éƒ¨å˜é‡ï¼šæ··æ·†
    """
    mappings = {}

    for block in blocks:
        if block['type'] == 'typedef':
            # æ··æ·†typedefåç§°
            obfuscated = self.generator.generate(block['name'], 'block')
            mappings[block['name']] = obfuscated

    return mappings
```

---

### åŠŸèƒ½å¢å¼ºæ€»ç»“

| åŠŸèƒ½ | å½“å‰æ”¯æŒ | ç›®æ ‡æ”¯æŒ | ä¼˜å…ˆçº§ |
|------|---------|---------|-------|
| Swiftæ³›å‹ | ç®€å•æ³›å‹ | å®Œæ•´æ³›å‹ | P0 |
| åè®®æ‰©å±• | ä¸æ”¯æŒ | å®Œæ•´æ”¯æŒ | P1 |
| ObjC++ | ä¸æ”¯æŒ | å®Œæ•´æ”¯æŒ | P2 |
| æ–¹æ³•é‡è½½ | éƒ¨åˆ†æ”¯æŒ | å®Œæ•´æ”¯æŒ | P0 |
| Blockæ··æ·† | ä¸æ”¯æŒ | å®Œæ•´æ”¯æŒ | P1 |

**å®æ–½æ—¶é—´çº¿**ï¼š
- Week 1-2ï¼šSwiftæ³›å‹ + æ–¹æ³•é‡è½½
- Week 3ï¼šåè®®æ‰©å±• + Blockæ··æ·†
- Week 4ï¼šObjC++æ··åˆè¯­æ³•

---

## ä¼˜å…ˆçº§ä¸‰ï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ– (v2.5.0) ğŸ¨

### 1. GUIç•Œé¢æ”¹è¿›

#### 1.1 é…ç½®é¢„è®¾ç®¡ç†

**éœ€æ±‚**ï¼šç”¨æˆ·å¸Œæœ›ä¿å­˜å¤šå¥—æ··æ·†é…ç½®ï¼Œå¿«é€Ÿåˆ‡æ¢ã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
# å¢å¼ºï¼šobfuscation_tab.py
class ConfigPresetManager:
    """é…ç½®é¢„è®¾ç®¡ç†å™¨"""

    def __init__(self):
        self.presets_file = Path("gui/obfuscation_presets.json")
        self.load_presets()

    def load_presets(self):
        """åŠ è½½é¢„è®¾"""
        if self.presets_file.exists():
            with open(self.presets_file, 'r') as f:
                self.presets = json.load(f)
        else:
            self.presets = {}

    def save_current_as_preset(self, name: str):
        """ä¿å­˜å½“å‰é…ç½®ä¸ºé¢„è®¾"""
        self.presets[name] = {
            'class_names': self.obfuscate_classes.get(),
            'method_names': self.obfuscate_methods.get(),
            # ... æ‰€æœ‰é…ç½®é¡¹
            'created_at': datetime.now().isoformat()
        }
        self._save_presets()

    def load_preset(self, name: str):
        """åŠ è½½é¢„è®¾"""
        if name in self.presets:
            preset = self.presets[name]
            self.obfuscate_classes.set(preset['class_names'])
            self.obfuscate_methods.set(preset['method_names'])
            # ... æ¢å¤æ‰€æœ‰é…ç½®
```

**UIè®¾è®¡**ï¼š
```python
# é¢„è®¾ä¸‹æ‹‰æ¡†
preset_frame = ttk.Frame(config_frame)
preset_frame.pack(fill=tk.X, pady=5)

ttk.Label(preset_frame, text="é…ç½®é¢„è®¾:").pack(side=tk.LEFT)

self.preset_var = tk.StringVar()
self.preset_combo = ttk.Combobox(
    preset_frame,
    textvariable=self.preset_var,
    values=list(self.preset_manager.presets.keys()),
    state="readonly"
)
self.preset_combo.pack(side=tk.LEFT, padx=5, fill=tk.X, expand=True)
self.preset_combo.bind("<<ComboboxSelected>>", self.on_preset_selected)

# ä¿å­˜/åˆ é™¤æŒ‰é’®
ttk.Button(preset_frame, text="ğŸ’¾ ä¿å­˜", command=self.save_preset).pack(side=tk.LEFT, padx=2)
ttk.Button(preset_frame, text="ğŸ—‘ï¸ åˆ é™¤", command=self.delete_preset).pack(side=tk.LEFT, padx=2)
```

---

#### 1.2 å®æ—¶é¢„è§ˆ

**éœ€æ±‚**ï¼šæ··æ·†å‰é¢„è§ˆéƒ¨åˆ†ä»£ç çš„æ··æ·†æ•ˆæœã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
class ObfuscationPreview:
    """æ··æ·†é¢„è§ˆå™¨"""

    def __init__(self, parent):
        self.preview_window = None

    def show_preview(self, sample_code: str):
        """æ˜¾ç¤ºæ··æ·†é¢„è§ˆ"""
        if self.preview_window:
            self.preview_window.destroy()

        # åˆ›å»ºé¢„è§ˆçª—å£
        self.preview_window = tk.Toplevel()
        self.preview_window.title("æ··æ·†é¢„è§ˆ")
        self.preview_window.geometry("900x600")

        # åˆ›å»ºå¯¹æ¯”è§†å›¾
        comparison_frame = ttk.Frame(self.preview_window)
        comparison_frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

        # å·¦ä¾§ï¼šåŸå§‹ä»£ç 
        left_frame = ttk.LabelFrame(comparison_frame, text="åŸå§‹ä»£ç ", padding=5)
        left_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=5)

        original_text = scrolledtext.ScrolledText(
            left_frame,
            wrap=tk.WORD,
            font=("Monaco", 10)
        )
        original_text.pack(fill=tk.BOTH, expand=True)
        original_text.insert('1.0', sample_code)
        original_text.config(state=tk.DISABLED)

        # å³ä¾§ï¼šæ··æ·†åä»£ç 
        right_frame = ttk.LabelFrame(comparison_frame, text="æ··æ·†åä»£ç ", padding=5)
        right_frame.pack(side=tk.LEFT, fill=tk.BOTH, expand=True, padx=5)

        obfuscated_text = scrolledtext.ScrolledText(
            right_frame,
            wrap=tk.WORD,
            font=("Monaco", 10)
        )
        obfuscated_text.pack(fill=tk.BOTH, expand=True)

        # æ‰§è¡Œæ··æ·†é¢„è§ˆ
        obfuscated = self._generate_preview_obfuscation(sample_code)
        obfuscated_text.insert('1.0', obfuscated)
        obfuscated_text.config(state=tk.DISABLED)

        # é«˜äº®å·®å¼‚
        self._highlight_differences(original_text, obfuscated_text)

    def _generate_preview_obfuscation(self, code: str) -> str:
        """ç”Ÿæˆæ··æ·†é¢„è§ˆï¼ˆä¸ä¿®æ”¹æ–‡ä»¶ï¼‰"""
        # ä½¿ç”¨å½“å‰é…ç½®è¿›è¡Œä¸´æ—¶æ··æ·†
        temp_parser = CodeParser(self.whitelist_manager)
        temp_generator = NameGenerator(...)

        # è§£æä»£ç 
        symbols = temp_parser.parse_code(code)

        # ç”Ÿæˆæ··æ·†å
        mappings = {}
        for symbol_type, symbol_list in symbols.items():
            for symbol in symbol_list:
                mappings[symbol['name']] = temp_generator.generate(symbol['name'], symbol_type)

        # æ›¿æ¢
        obfuscated = code
        for original, obfuscated_name in mappings.items():
            obfuscated = obfuscated.replace(original, obfuscated_name)

        return obfuscated
```

**UIé›†æˆ**ï¼š
```python
# æ·»åŠ é¢„è§ˆæŒ‰é’®
preview_button = ttk.Button(
    button_frame,
    text="ğŸ‘ï¸ é¢„è§ˆæ··æ·†æ•ˆæœ",
    command=self.show_preview_dialog
)
preview_button.pack(side=tk.LEFT, padx=3)

def show_preview_dialog(self):
    """æ˜¾ç¤ºé¢„è§ˆå¯¹è¯æ¡†"""
    # é€‰æ‹©ç¤ºä¾‹æ–‡ä»¶
    file_path = filedialog.askopenfilename(
        title="é€‰æ‹©è¦é¢„è§ˆçš„æ–‡ä»¶",
        filetypes=[("æºæ–‡ä»¶", "*.h;*.m;*.swift")]
    )

    if file_path:
        with open(file_path, 'r') as f:
            sample_code = f.read()

        # æ˜¾ç¤ºé¢„è§ˆ
        self.preview_manager.show_preview(sample_code)
```

---

#### 1.3 æ··æ·†å‰åå¯¹æ¯”

**éœ€æ±‚**ï¼šæ··æ·†å®Œæˆåï¼ŒæŸ¥çœ‹è¯¦ç»†çš„å˜æ›´å¯¹æ¯”ã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
class ObfuscationDiffViewer:
    """æ··æ·†å·®å¼‚æŸ¥çœ‹å™¨"""

    def show_diff(self, original_path: str, obfuscated_path: str):
        """æ˜¾ç¤ºå·®å¼‚"""
        import difflib

        # è¯»å–æ–‡ä»¶
        with open(original_path, 'r') as f:
            original_lines = f.readlines()

        with open(obfuscated_path, 'r') as f:
            obfuscated_lines = f.readlines()

        # ç”Ÿæˆdiff
        diff = difflib.unified_diff(
            original_lines,
            obfuscated_lines,
            fromfile='åŸå§‹',
            tofile='æ··æ·†å',
            lineterm=''
        )

        # åˆ›å»ºæŸ¥çœ‹çª—å£
        self._create_diff_window(diff)

    def _create_diff_window(self, diff):
        """åˆ›å»ºå·®å¼‚æŸ¥çœ‹çª—å£"""
        window = tk.Toplevel()
        window.title("æ··æ·†å¯¹æ¯”")
        window.geometry("1000x700")

        # åˆ›å»ºæ–‡æœ¬ç»„ä»¶
        text = scrolledtext.ScrolledText(
            window,
            wrap=tk.WORD,
            font=("Monaco", 9)
        )
        text.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

        # é…ç½®é¢œè‰²æ ‡ç­¾
        text.tag_config("add", foreground="green", background="#e6ffe6")
        text.tag_config("remove", foreground="red", background="#ffe6e6")
        text.tag_config("info", foreground="blue")

        # æ’å…¥diffå†…å®¹
        for line in diff:
            if line.startswith('+'):
                text.insert(tk.END, line + '\n', 'add')
            elif line.startswith('-'):
                text.insert(tk.END, line + '\n', 'remove')
            elif line.startswith('@@'):
                text.insert(tk.END, line + '\n', 'info')
            else:
                text.insert(tk.END, line + '\n')

        text.config(state=tk.DISABLED)
```

---

### 2. CLIå¢å¼º

#### 2.1 äº¤äº’å¼é…ç½®å‘å¯¼

**éœ€æ±‚**ï¼šé¦–æ¬¡ä½¿ç”¨CLIæ—¶ï¼Œé€šè¿‡é—®ç­”å¼å‘å¯¼åˆ›å»ºé…ç½®ã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
# å¢å¼ºï¼šobfuscation_cli.py
class InteractiveConfigWizard:
    """äº¤äº’å¼é…ç½®å‘å¯¼"""

    def run(self) -> ObfuscationConfig:
        """è¿è¡Œå‘å¯¼"""
        print("ğŸ§™ iOSæ··æ·†é…ç½®å‘å¯¼")
        print("=" * 50)

        # 1. é¡¹ç›®ç±»å‹
        project_type = self._ask_project_type()

        # 2. æ··æ·†çº§åˆ«
        obfuscation_level = self._ask_obfuscation_level()

        # 3. å‘½åç­–ç•¥
        naming_strategy = self._ask_naming_strategy()

        # 4. èµ„æºå¤„ç†
        resource_options = self._ask_resource_options()

        # 5. é«˜çº§é€‰é¡¹
        advanced_options = self._ask_advanced_options()

        # ç”Ÿæˆé…ç½®
        config = self._build_config(
            project_type,
            obfuscation_level,
            naming_strategy,
            resource_options,
            advanced_options
        )

        # ä¿å­˜é…ç½®
        self._save_config(config)

        return config

    def _ask_project_type(self) -> str:
        """è¯¢é—®é¡¹ç›®ç±»å‹"""
        print("\n1ï¸âƒ£ é¡¹ç›®ç±»å‹:")
        print("  [1] çº¯ObjCé¡¹ç›®")
        print("  [2] çº¯Swifté¡¹ç›®")
        print("  [3] ObjC/Swiftæ··åˆé¡¹ç›®")

        choice = input("\nè¯·é€‰æ‹© (1-3): ").strip()

        return {
            '1': 'objc',
            '2': 'swift',
            '3': 'mixed'
        }.get(choice, 'mixed')

    def _ask_obfuscation_level(self) -> str:
        """è¯¢é—®æ··æ·†çº§åˆ«"""
        print("\n2ï¸âƒ£ æ··æ·†çº§åˆ«:")
        print("  [1] æœ€å°åŒ– - ä»…æ··æ·†ç±»åå’Œæ–¹æ³•å")
        print("  [2] æ ‡å‡†   - å¹³è¡¡çš„æ··æ·†ç­–ç•¥ï¼ˆæ¨èï¼‰")
        print("  [3] æ¿€è¿›   - æœ€å¼ºæ··æ·†åŠ›åº¦")

        choice = input("\nè¯·é€‰æ‹© (1-3): ").strip()

        return {
            '1': 'minimal',
            '2': 'standard',
            '3': 'aggressive'
        }.get(choice, 'standard')

    def _ask_naming_strategy(self) -> str:
        """è¯¢é—®å‘½åç­–ç•¥"""
        print("\n3ï¸âƒ£ å‘½åç­–ç•¥:")
        print("  [1] éšæœº - å®Œå…¨éšæœºï¼ˆæœ€å®‰å…¨ï¼‰")
        print("  [2] å‰ç¼€ - å¸¦å‰ç¼€çš„éšæœºåï¼ˆå¯è¯»æ€§ï¼‰")
        print("  [3] è¯å…¸ - è¯å…¸ç»„åˆï¼ˆçœ‹èµ·æ¥åƒçœŸå®ä»£ç ï¼‰")

        choice = input("\nè¯·é€‰æ‹© (1-3): ").strip()

        return {
            '1': 'random',
            '2': 'prefix',
            '3': 'dictionary'
        }.get(choice, 'random')

    # ... å…¶ä»–è¯¢é—®æ–¹æ³•
```

**CLIä½¿ç”¨**ï¼š
```bash
# è¿è¡Œå‘å¯¼
python -m gui.modules.obfuscation.obfuscation_cli --wizard

# è¾“å‡ºç¤ºä¾‹ï¼š
# ğŸ§™ iOSæ··æ·†é…ç½®å‘å¯¼
# ==================================================
#
# 1ï¸âƒ£ é¡¹ç›®ç±»å‹:
#   [1] çº¯ObjCé¡¹ç›®
#   [2] çº¯Swifté¡¹ç›®
#   [3] ObjC/Swiftæ··åˆé¡¹ç›®
#
# è¯·é€‰æ‹© (1-3): 3
#
# 2ï¸âƒ£ æ··æ·†çº§åˆ«:
#   [1] æœ€å°åŒ–
#   [2] æ ‡å‡†ï¼ˆæ¨èï¼‰
#   [3] æ¿€è¿›
#
# è¯·é€‰æ‹© (1-3): 2
#
# ... (ç»§ç»­é—®ç­”)
#
# âœ… é…ç½®å·²ä¿å­˜åˆ°: obfuscation_config.json
```

---

#### 2.2 æ‰¹é‡é¡¹ç›®å¤„ç†

**éœ€æ±‚**ï¼šä¸€æ¬¡æ··æ·†å¤šä¸ªiOSé¡¹ç›®ã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
# æ–°å¢ï¼šbatch_obfuscate.py
class BatchObfuscator:
    """æ‰¹é‡æ··æ·†å™¨"""

    def __init__(self, config_file: str):
        with open(config_file, 'r') as f:
            self.batch_config = json.load(f)

    def run(self):
        """æ‰§è¡Œæ‰¹é‡æ··æ·†"""
        projects = self.batch_config['projects']

        results = []
        for project in projects:
            print(f"\n{'='*60}")
            print(f"æ··æ·†é¡¹ç›®: {project['name']}")
            print(f"{'='*60}")

            result = self._obfuscate_project(project)
            results.append(result)

        # ç”Ÿæˆæ‰¹é‡æŠ¥å‘Š
        self._generate_batch_report(results)

    def _obfuscate_project(self, project: Dict) -> Dict:
        """æ··æ·†å•ä¸ªé¡¹ç›®"""
        engine = ObfuscationEngine(config)

        start_time = time.time()

        result = engine.obfuscate(
            project['path'],
            project['output'],
            progress_callback=self._progress_callback
        )

        elapsed = time.time() - start_time

        return {
            'project': project['name'],
            'success': result.success,
            'elapsed': elapsed,
            'files_processed': result.files_processed,
            'errors': result.errors
        }

    def _generate_batch_report(self, results: List[Dict]):
        """ç”Ÿæˆæ‰¹é‡æŠ¥å‘Š"""
        print(f"\n{'='*60}")
        print("æ‰¹é‡æ··æ·†æŠ¥å‘Š")
        print(f"{'='*60}\n")

        total = len(results)
        success = sum(1 for r in results if r['success'])
        failed = total - success

        print(f"æ€»é¡¹ç›®æ•°: {total}")
        print(f"æˆåŠŸ: {success}")
        print(f"å¤±è´¥: {failed}")
        print(f"\nè¯¦ç»†ç»“æœ:")

        for result in results:
            status = "âœ…" if result['success'] else "âŒ"
            print(f"  {status} {result['project']}: {result['elapsed']:.2f}ç§’, {result['files_processed']}ä¸ªæ–‡ä»¶")

            if result['errors']:
                for error in result['errors']:
                    print(f"      é”™è¯¯: {error}")
```

**æ‰¹é‡é…ç½®æ–‡ä»¶**ï¼š
```json
{
  "version": "1.0",
  "projects": [
    {
      "name": "MyApp",
      "path": "/path/to/MyApp",
      "output": "/path/to/MyApp_obfuscated",
      "config": "standard"
    },
    {
      "name": "MyFramework",
      "path": "/path/to/MyFramework",
      "output": "/path/to/MyFramework_obfuscated",
      "config": "aggressive"
    }
  ],
  "global_config": {
    "name_prefix": "WHC",
    "use_fixed_seed": true
  }
}
```

**CLIä½¿ç”¨**ï¼š
```bash
# æ‰¹é‡æ··æ·†
python -m gui.modules.obfuscation.batch_obfuscate --config batch_config.json

# è¾“å‡ºï¼š
# ============================================================
# æ··æ·†é¡¹ç›®: MyApp
# ============================================================
# [10%] å¼€å§‹åˆ†æé¡¹ç›®ç»“æ„...
# [20%] åˆå§‹åŒ–ç™½åå•...
# ...
# âœ… æ··æ·†æˆåŠŸå®Œæˆï¼
#
# ============================================================
# æ··æ·†é¡¹ç›®: MyFramework
# ============================================================
# ...
#
# ============================================================
# æ‰¹é‡æ··æ·†æŠ¥å‘Š
# ============================================================
#
# æ€»é¡¹ç›®æ•°: 2
# æˆåŠŸ: 2
# å¤±è´¥: 0
#
# è¯¦ç»†ç»“æœ:
#   âœ… MyApp: 45.32ç§’, 234ä¸ªæ–‡ä»¶
#   âœ… MyFramework: 12.78ç§’, 56ä¸ªæ–‡ä»¶
```

---

### 3. é”™è¯¯æç¤ºä¼˜åŒ–

#### 3.1 å‹å¥½çš„é”™è¯¯ä¿¡æ¯

**å½“å‰é—®é¢˜**ï¼š
```
é”™è¯¯: æ··æ·†å¤±è´¥
Traceback (most recent call last):
  File "obfuscation_engine.py", line 150
    ...
KeyError: 'MyClass'
```

**ä¼˜åŒ–å**ï¼š
```python
class UserFriendlyError(Exception):
    """ç”¨æˆ·å‹å¥½çš„é”™è¯¯"""

    def __init__(self, error_type: str, details: Dict):
        self.error_type = error_type
        self.details = details

        # ç”Ÿæˆå‹å¥½æ¶ˆæ¯
        self.message = self._format_message()

    def _format_message(self) -> str:
        """æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯"""
        messages = {
            'parse_error': self._format_parse_error,
            'whitelist_error': self._format_whitelist_error,
            'mapping_error': self._format_mapping_error,
        }

        formatter = messages.get(self.error_type, self._format_generic_error)
        return formatter()

    def _format_parse_error(self) -> str:
        """æ ¼å¼åŒ–è§£æé”™è¯¯"""
        file = self.details.get('file', 'æœªçŸ¥æ–‡ä»¶')
        line = self.details.get('line', 0)

        return f"""
âŒ ä»£ç è§£æå¤±è´¥

ğŸ“ æ–‡ä»¶: {file}
ğŸ“ è¡Œå·: {line}

ğŸ” å¯èƒ½åŸå› :
1. ä»£ç å­˜åœ¨è¯­æ³•é”™è¯¯
2. ä½¿ç”¨äº†ä¸æ”¯æŒçš„Objective-C/Swiftç‰¹æ€§
3. æ–‡ä»¶ç¼–ç é—®é¢˜

ğŸ’¡ å»ºè®®æ“ä½œ:
1. æ£€æŸ¥æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®
2. ä½¿ç”¨Xcodeç¼–è¯‘æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
3. å°†æ­¤æ–‡ä»¶æ·»åŠ åˆ°ç™½åå•è·³è¿‡æ··æ·†

ğŸ“– å‚è€ƒæ–‡æ¡£: https://docs.example.com/parse-errors
"""

    # ... å…¶ä»–æ ¼å¼åŒ–æ–¹æ³•
```

**é›†æˆåˆ°å¼•æ“**ï¼š
```python
try:
    result = self.code_parser.parse_file(file_path)
except Exception as e:
    raise UserFriendlyError('parse_error', {
        'file': file_path,
        'line': extract_line_number(e),
        'original_error': str(e)
    })
```

---

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–æ€»ç»“

| åŠŸèƒ½ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | ç”¨æˆ·ä»·å€¼ |
|------|---------|---------|---------|
| é…ç½®é¢„è®¾ | æ—  | å®Œæ•´æ”¯æŒ | å¿«é€Ÿåˆ‡æ¢é…ç½® |
| å®æ—¶é¢„è§ˆ | æ—  | å®Œæ•´æ”¯æŒ | æ··æ·†å‰éªŒè¯æ•ˆæœ |
| å‰åå¯¹æ¯” | æ—  | å®Œæ•´æ”¯æŒ | æ¸…æ™°äº†è§£å˜æ›´ |
| äº¤äº’å¼å‘å¯¼ | æ—  | å®Œæ•´æ”¯æŒ | é™ä½ä½¿ç”¨é—¨æ§› |
| æ‰¹é‡å¤„ç† | æ—  | å®Œæ•´æ”¯æŒ | æå‡æ•ˆç‡ |
| å‹å¥½é”™è¯¯ | æŠ€æœ¯å †æ ˆ | ç”¨æˆ·å‹å¥½ | å¿«é€Ÿå®šä½é—®é¢˜ |

**å®æ–½æ—¶é—´çº¿**ï¼š
- Week 1ï¼šé…ç½®é¢„è®¾ + å®æ—¶é¢„è§ˆ
- Week 2ï¼šå‰åå¯¹æ¯” + å‹å¥½é”™è¯¯
- Week 3ï¼šäº¤äº’å¼å‘å¯¼ + æ‰¹é‡å¤„ç†

---

## ä¼˜å…ˆçº§å››ï¼šä¼ä¸šçº§ç‰¹æ€§ (v3.0.0) ğŸ¢

### 1. å›¢é˜Ÿåä½œæ”¯æŒ

#### 1.1 å…±äº«é…ç½®ä¸­å¿ƒ

**éœ€æ±‚**ï¼šå›¢é˜Ÿæˆå‘˜å…±äº«æ··æ·†é…ç½®ï¼Œç¡®ä¿ä¸€è‡´æ€§ã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
# æ–°å¢ï¼šteam_config_sync.py
class TeamConfigServer:
    """å›¢é˜Ÿé…ç½®æœåŠ¡å™¨"""

    def __init__(self, server_url: str):
        self.server_url = server_url
        self.api_key = os.getenv('OBFUSCATION_API_KEY')

    def upload_config(self, config: ObfuscationConfig, team_id: str):
        """ä¸Šä¼ é…ç½®åˆ°æœåŠ¡å™¨"""
        response = requests.post(
            f"{self.server_url}/api/teams/{team_id}/configs",
            headers={'Authorization': f'Bearer {self.api_key}'},
            json=config.to_dict()
        )

        if response.status_code == 200:
            return response.json()['config_id']
        else:
            raise Exception(f"ä¸Šä¼ å¤±è´¥: {response.text}")

    def download_config(self, config_id: str) -> ObfuscationConfig:
        """ä»æœåŠ¡å™¨ä¸‹è½½é…ç½®"""
        response = requests.get(
            f"{self.server_url}/api/configs/{config_id}",
            headers={'Authorization': f'Bearer {self.api_key}'}
        )

        if response.status_code == 200:
            return ObfuscationConfig.from_dict(response.json())
        else:
            raise Exception(f"ä¸‹è½½å¤±è´¥: {response.text}")

    def list_team_configs(self, team_id: str) -> List[Dict]:
        """åˆ—å‡ºå›¢é˜Ÿçš„æ‰€æœ‰é…ç½®"""
        response = requests.get(
            f"{self.server_url}/api/teams/{team_id}/configs",
            headers={'Authorization': f'Bearer {self.api_key}'}
        )

        return response.json()['configs']
```

**UIé›†æˆ**ï¼š
```python
# å›¢é˜Ÿé…ç½®åŒæ­¥æŒ‰é’®
team_frame = ttk.Frame(toolbar)
team_frame.pack(side=tk.RIGHT)

ttk.Button(
    team_frame,
    text="â˜ï¸ åŒæ­¥é…ç½®",
    command=self.sync_team_config
).pack(side=tk.LEFT, padx=3)

def sync_team_config(self):
    """åŒæ­¥å›¢é˜Ÿé…ç½®"""
    dialog = TeamConfigDialog(self)
    dialog.show()

    if dialog.result == 'download':
        # ä¸‹è½½é…ç½®
        config = self.team_server.download_config(dialog.selected_config_id)
        self.load_config(config)
    elif dialog.result == 'upload':
        # ä¸Šä¼ å½“å‰é…ç½®
        config_id = self.team_server.upload_config(self.get_current_config(), team_id)
        messagebox.showinfo("æˆåŠŸ", f"é…ç½®å·²ä¸Šä¼ : {config_id}")
```

---

#### 1.2 æ··æ·†å†å²å’Œç‰ˆæœ¬æ§åˆ¶

**éœ€æ±‚**ï¼šè¿½è¸ªæ¯æ¬¡æ··æ·†çš„é…ç½®å’Œç»“æœï¼Œä¾¿äºå›æº¯ã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
# æ–°å¢ï¼šobfuscation_history.py
class ObfuscationHistory:
    """æ··æ·†å†å²è®°å½•å™¨"""

    def __init__(self, history_file=".obfuscation_history"):
        self.history_file = Path(history_file)
        self.load_history()

    def load_history(self):
        """åŠ è½½å†å²è®°å½•"""
        if self.history_file.exists():
            with open(self.history_file, 'r') as f:
                self.history = json.load(f)
        else:
            self.history = []

    def record_obfuscation(self,
                          config: ObfuscationConfig,
                          result: ObfuscationResult):
        """è®°å½•ä¸€æ¬¡æ··æ·†"""
        record = {
            'id': str(uuid.uuid4()),
            'timestamp': datetime.now().isoformat(),
            'project': result.project_name,
            'config': config.to_dict(),
            'result': {
                'success': result.success,
                'files_processed': result.files_processed,
                'total_replacements': result.total_replacements,
                'elapsed_time': result.elapsed_time,
            },
            'mapping_file': result.mapping_file,
            'git_commit': self._get_git_commit(),
        }

        self.history.append(record)
        self._save_history()

    def get_last_config(self, project_name: str) -> Optional[ObfuscationConfig]:
        """è·å–ä¸Šæ¬¡æ··æ·†çš„é…ç½®"""
        for record in reversed(self.history):
            if record['project'] == project_name and record['result']['success']:
                return ObfuscationConfig.from_dict(record['config'])

        return None

    def get_history_by_date(self, start_date: str, end_date: str) -> List[Dict]:
        """æŒ‰æ—¥æœŸæŸ¥è¯¢å†å²"""
        start = datetime.fromisoformat(start_date)
        end = datetime.fromisoformat(end_date)

        return [
            record for record in self.history
            if start <= datetime.fromisoformat(record['timestamp']) <= end
        ]

    def rollback_to_version(self, record_id: str):
        """å›æ»šåˆ°æŸä¸ªç‰ˆæœ¬çš„é…ç½®"""
        for record in self.history:
            if record['id'] == record_id:
                return ObfuscationConfig.from_dict(record['config'])

        return None
```

**GUIå†å²æŸ¥çœ‹å™¨**ï¼š
```python
class ObfuscationHistoryViewer:
    """æ··æ·†å†å²æŸ¥çœ‹å™¨"""

    def show_history(self, project_name: str):
        """æ˜¾ç¤ºå†å²è®°å½•"""
        window = tk.Toplevel()
        window.title("æ··æ·†å†å²")
        window.geometry("1000x600")

        # åˆ›å»ºåˆ—è¡¨
        columns = ("æ—¶é—´", "é¡¹ç›®", "æ–‡ä»¶æ•°", "æ›¿æ¢æ•°", "è€—æ—¶", "çŠ¶æ€")
        tree = ttk.Treeview(window, columns=columns, show="headings")

        for col in columns:
            tree.heading(col, text=col)

        # å¡«å……æ•°æ®
        history = self.history_manager.get_history_by_project(project_name)
        for record in history:
            tree.insert('', tk.END, values=(
                record['timestamp'],
                record['project'],
                record['result']['files_processed'],
                record['result']['total_replacements'],
                f"{record['result']['elapsed_time']:.2f}ç§’",
                "âœ…" if record['result']['success'] else "âŒ"
            ))

        tree.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

        # æ“ä½œæŒ‰é’®
        button_frame = ttk.Frame(window)
        button_frame.pack(fill=tk.X, padx=10, pady=5)

        ttk.Button(
            button_frame,
            text="æŸ¥çœ‹é…ç½®",
            command=lambda: self.view_config(tree.selection())
        ).pack(side=tk.LEFT, padx=3)

        ttk.Button(
            button_frame,
            text="å›æ»šåˆ°æ­¤ç‰ˆæœ¬",
            command=lambda: self.rollback_to_version(tree.selection())
        ).pack(side=tk.LEFT, padx=3)

        ttk.Button(
            button_frame,
            text="å¯¼å‡ºæ˜ å°„æ–‡ä»¶",
            command=lambda: self.export_mapping(tree.selection())
        ).pack(side=tk.LEFT, padx=3)
```

---

### 2. æ··æ·†æ•ˆæœè¯„ä¼°

#### 2.1 ä»£ç ç›¸ä¼¼åº¦åˆ†æ

**éœ€æ±‚**ï¼šé‡åŒ–æ··æ·†å‰åä»£ç çš„ç›¸ä¼¼åº¦ï¼Œè¯„ä¼°æ··æ·†æ•ˆæœã€‚

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
# æ–°å¢ï¼šsimilarity_analyzer.py
import difflib
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity

class CodeSimilarityAnalyzer:
    """ä»£ç ç›¸ä¼¼åº¦åˆ†æå™¨"""

    def __init__(self):
        self.vectorizer = TfidfVectorizer()

    def calculate_similarity(self,
                           original_code: str,
                           obfuscated_code: str) -> float:
        """
        è®¡ç®—ä»£ç ç›¸ä¼¼åº¦

        è¿”å›ï¼š
        0.0 - å®Œå…¨ä¸åŒ
        1.0 - å®Œå…¨ç›¸åŒ

        æ··æ·†æ•ˆæœè¯„ä¼°ï¼š
        > 0.8 - æ··æ·†ä¸è¶³
        0.5-0.8 - ä¸­ç­‰æ··æ·†
        < 0.5 - è‰¯å¥½æ··æ·†
        """
        # ä½¿ç”¨TF-IDFå‘é‡åŒ–
        vectors = self.vectorizer.fit_transform([original_code, obfuscated_code])

        # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
        similarity = cosine_similarity(vectors[0:1], vectors[1:2])[0][0]

        return similarity

    def calculate_identifier_overlap(self,
                                    original_symbols: Dict,
                                    obfuscated_symbols: Dict) -> float:
        """
        è®¡ç®—æ ‡è¯†ç¬¦é‡å ç‡

        è¿”å›ï¼š
        æ ‡è¯†ç¬¦é‡å ç™¾åˆ†æ¯”

        ç›®æ ‡ï¼š<5% (95%çš„æ ‡è¯†ç¬¦è¢«æ··æ·†)
        """
        original_names = set()
        for symbol_type, symbols in original_symbols.items():
            for symbol in symbols:
                original_names.add(symbol['name'])

        obfuscated_names = set()
        for symbol_type, symbols in obfuscated_symbols.items():
            for symbol in symbols:
                obfuscated_names.add(symbol['name'])

        # è®¡ç®—é‡å 
        overlap = original_names & obfuscated_names

        if not original_names:
            return 0.0

        return len(overlap) / len(original_names)

    def calculate_structure_similarity(self,
                                      original_ast: Dict,
                                      obfuscated_ast: Dict) -> float:
        """
        è®¡ç®—ä»£ç ç»“æ„ç›¸ä¼¼åº¦

        æ¯”è¾ƒASTç»“æ„ï¼Œå¿½ç•¥æ ‡è¯†ç¬¦åç§°

        è¿”å›ï¼šç»“æ„ç›¸ä¼¼åº¦ï¼ˆåº”æ¥è¿‘1.0ï¼‰
        """
        # æ¯”è¾ƒASTèŠ‚ç‚¹ç±»å‹å’Œå±‚æ¬¡
        original_structure = self._extract_structure(original_ast)
        obfuscated_structure = self._extract_structure(obfuscated_ast)

        # è®¡ç®—ç›¸ä¼¼åº¦
        similarity = difflib.SequenceMatcher(
            None,
            original_structure,
            obfuscated_structure
        ).ratio()

        return similarity

    def generate_report(self,
                       original_path: str,
                       obfuscated_path: str) -> Dict:
        """ç”Ÿæˆæ··æ·†æ•ˆæœæŠ¥å‘Š"""
        # è¯»å–æ–‡ä»¶
        with open(original_path, 'r') as f:
            original_code = f.read()

        with open(obfuscated_path, 'r') as f:
            obfuscated_code = f.read()

        # è®¡ç®—å„é¡¹æŒ‡æ ‡
        code_similarity = self.calculate_similarity(original_code, obfuscated_code)

        # è§£æç¬¦å·
        original_symbols = self._parse_symbols(original_code)
        obfuscated_symbols = self._parse_symbols(obfuscated_code)

        identifier_overlap = self.calculate_identifier_overlap(
            original_symbols,
            obfuscated_symbols
        )

        # ç”ŸæˆæŠ¥å‘Š
        report = {
            'code_similarity': code_similarity,
            'identifier_overlap': identifier_overlap,
            'assessment': self._assess_obfuscation(code_similarity, identifier_overlap),
            'recommendations': self._generate_recommendations(code_similarity, identifier_overlap)
        }

        return report

    def _assess_obfuscation(self, code_sim: float, id_overlap: float) -> str:
        """è¯„ä¼°æ··æ·†æ•ˆæœ"""
        if id_overlap < 0.05 and code_sim < 0.5:
            return "ä¼˜ç§€ - æ··æ·†æ•ˆæœéå¸¸å¥½"
        elif id_overlap < 0.1 and code_sim < 0.7:
            return "è‰¯å¥½ - æ··æ·†æ•ˆæœè¾ƒå¥½"
        elif id_overlap < 0.2 and code_sim < 0.8:
            return "ä¸­ç­‰ - æ··æ·†æ•ˆæœä¸€èˆ¬"
        else:
            return "ä¸è¶³ - å»ºè®®æé«˜æ··æ·†å¼ºåº¦"
```

**CLIé›†æˆ**ï¼š
```bash
# è¯„ä¼°æ··æ·†æ•ˆæœ
python -m gui.modules.obfuscation.obfuscation_cli \
    --evaluate \
    --original /path/to/original \
    --obfuscated /path/to/obfuscated \
    --report obfuscation_report.html

# è¾“å‡ºç¤ºä¾‹ï¼š
# ============================================================
# æ··æ·†æ•ˆæœè¯„ä¼°æŠ¥å‘Š
# ============================================================
#
# ğŸ“Š ç»¼åˆè¯„ä¼°: ä¼˜ç§€ - æ··æ·†æ•ˆæœéå¸¸å¥½
#
# ğŸ“ˆ è¯¦ç»†æŒ‡æ ‡:
#   ä»£ç ç›¸ä¼¼åº¦: 0.42 (ç›®æ ‡: <0.5)
#   æ ‡è¯†ç¬¦é‡å ç‡: 3.2% (ç›®æ ‡: <5%)
#   ç»“æ„ç›¸ä¼¼åº¦: 0.98 (ç›®æ ‡: >0.95)
#
# ğŸ’¡ å»ºè®®:
#   âœ… æ··æ·†å¼ºåº¦é€‚ä¸­ï¼Œæ— éœ€è°ƒæ•´
#   âœ… æ ‡è¯†ç¬¦æ··æ·†å……åˆ†
#   âœ… ä»£ç ç»“æ„ä¿æŒå®Œæ•´
#
# ğŸ“„ è¯¦ç»†æŠ¥å‘Šå·²ç”Ÿæˆ: obfuscation_report.html
```

---

#### 2.2 æ··æ·†å¼ºåº¦å¯è§†åŒ–

**å®ç°æ–¹æ¡ˆ**ï¼š
```python
# æ–°å¢ï¼šobfuscation_visualization.py
import matplotlib.pyplot as plt
import seaborn as sns

class ObfuscationVisualizer:
    """æ··æ·†æ•ˆæœå¯è§†åŒ–"""

    def plot_similarity_trend(self, history: List[Dict]):
        """ç»˜åˆ¶ç›¸ä¼¼åº¦è¶‹åŠ¿å›¾"""
        timestamps = [h['timestamp'] for h in history]
        similarities = [h['code_similarity'] for h in history]

        plt.figure(figsize=(10, 6))
        plt.plot(timestamps, similarities, marker='o')
        plt.axhline(y=0.5, color='r', linestyle='--', label='ç›®æ ‡çº¿')
        plt.xlabel('æ—¶é—´')
        plt.ylabel('ä»£ç ç›¸ä¼¼åº¦')
        plt.title('æ··æ·†æ•ˆæœè¶‹åŠ¿')
        plt.legend()
        plt.xticks(rotation=45)
        plt.tight_layout()
        plt.savefig('similarity_trend.png')

    def plot_obfuscation_coverage(self, symbols: Dict[str, int]):
        """ç»˜åˆ¶æ··æ·†è¦†ç›–ç‡é¥¼å›¾"""
        labels = ['å·²æ··æ·†', 'æœªæ··æ·†ï¼ˆç™½åå•ï¼‰', 'ç³»ç»ŸAPI']
        sizes = [
            symbols['obfuscated'],
            symbols['whitelisted'],
            symbols['system_api']
        ]

        colors = ['#4CAF50', '#FFC107', '#2196F3']
        explode = (0.1, 0, 0)

        plt.figure(figsize=(8, 8))
        plt.pie(sizes, explode=explode, labels=labels, colors=colors,
                autopct='%1.1f%%', shadow=True, startangle=90)
        plt.title('ç¬¦å·æ··æ·†è¦†ç›–ç‡')
        plt.axis('equal')
        plt.savefig('obfuscation_coverage.png')

    def generate_html_report(self, report_data: Dict):
        """ç”ŸæˆHTMLæŠ¥å‘Š"""
        html = f"""
<!DOCTYPE html>
<html>
<head>
    <title>æ··æ·†æ•ˆæœæŠ¥å‘Š</title>
    <style>
        body {{ font-family: Arial, sans-serif; margin: 20px; }}
        .header {{ background: #2196F3; color: white; padding: 20px; }}
        .metric {{ display: inline-block; margin: 20px; text-align: center; }}
        .metric-value {{ font-size: 48px; font-weight: bold; }}
        .metric-label {{ font-size: 14px; color: #666; }}
        .good {{ color: #4CAF50; }}
        .warning {{ color: #FFC107; }}
        .bad {{ color: #F44336; }}
    </style>
</head>
<body>
    <div class="header">
        <h1>iOSæ··æ·†æ•ˆæœè¯„ä¼°æŠ¥å‘Š</h1>
        <p>é¡¹ç›®: {report_data['project_name']}</p>
        <p>æ—¶é—´: {report_data['timestamp']}</p>
    </div>

    <div class="metrics">
        <div class="metric">
            <div class="metric-value good">{report_data['code_similarity']:.2%}</div>
            <div class="metric-label">ä»£ç ç›¸ä¼¼åº¦</div>
        </div>

        <div class="metric">
            <div class="metric-value good">{report_data['identifier_overlap']:.2%}</div>
            <div class="metric-label">æ ‡è¯†ç¬¦é‡å ç‡</div>
        </div>

        <div class="metric">
            <div class="metric-value good">{report_data['structure_similarity']:.2%}</div>
            <div class="metric-label">ç»“æ„ç›¸ä¼¼åº¦</div>
        </div>
    </div>

    <h2>è¯¦ç»†åˆ†æ</h2>
    <p>{report_data['assessment']}</p>

    <h2>å»ºè®®</h2>
    <ul>
        {''.join(f'<li>{rec}</li>' for rec in report_data['recommendations'])}
    </ul>

    <h2>å¯è§†åŒ–</h2>
    <img src="similarity_trend.png" alt="ç›¸ä¼¼åº¦è¶‹åŠ¿">
    <img src="obfuscation_coverage.png" alt="æ··æ·†è¦†ç›–ç‡">
</body>
</html>
"""
        return html
```

---

### 3. å®‰å…¨å®¡è®¡æ—¥å¿—

#### éœ€æ±‚
è®°å½•æ‰€æœ‰æ··æ·†æ“ä½œï¼Œç”¨äºå®‰å…¨å®¡è®¡å’Œåˆè§„æ€§æ£€æŸ¥ã€‚

#### å®ç°æ–¹æ¡ˆ

```python
# æ–°å¢ï¼šsecurity_audit_log.py
import logging
from logging.handlers import RotatingFileHandler

class SecurityAuditLogger:
    """å®‰å…¨å®¡è®¡æ—¥å¿—"""

    def __init__(self, log_file="obfuscation_audit.log"):
        self.logger = logging.getLogger('obfuscation_audit')
        self.logger.setLevel(logging.INFO)

        # æ–‡ä»¶å¤„ç†å™¨ï¼ˆè‡ªåŠ¨è½®è½¬ï¼‰
        handler = RotatingFileHandler(
            log_file,
            maxBytes=10*1024*1024,  # 10MB
            backupCount=5
        )

        formatter = logging.Formatter(
            '[%(asctime)s] [%(levelname)s] [%(user)s] [%(action)s] %(message)s'
        )
        handler.setFormatter(formatter)

        self.logger.addHandler(handler)

    def log_obfuscation_start(self, user: str, project: str, config: Dict):
        """è®°å½•æ··æ·†å¼€å§‹"""
        self.logger.info(
            "æ··æ·†å¼€å§‹",
            extra={
                'user': user,
                'action': 'obfuscation_start',
                'project': project,
                'config_hash': self._hash_config(config)
            }
        )

    def log_obfuscation_complete(self, user: str, project: str, result: Dict):
        """è®°å½•æ··æ·†å®Œæˆ"""
        self.logger.info(
            f"æ··æ·†å®Œæˆ - æˆåŠŸ: {result['success']}, æ–‡ä»¶: {result['files_processed']}",
            extra={
                'user': user,
                'action': 'obfuscation_complete',
                'project': project
            }
        )

    def log_config_export(self, user: str, config_id: str):
        """è®°å½•é…ç½®å¯¼å‡º"""
        self.logger.warning(
            f"é…ç½®å¯¼å‡º - ID: {config_id}",
            extra={
                'user': user,
                'action': 'config_export'
            }
        )

    def log_mapping_access(self, user: str, mapping_file: str):
        """è®°å½•æ˜ å°„æ–‡ä»¶è®¿é—®"""
        self.logger.info(
            f"è®¿é—®æ˜ å°„æ–‡ä»¶ - {mapping_file}",
            extra={
                'user': user,
                'action': 'mapping_access'
            }
        )

    def log_security_event(self, user: str, event_type: str, details: str):
        """è®°å½•å®‰å…¨äº‹ä»¶"""
        self.logger.warning(
            f"å®‰å…¨äº‹ä»¶ - {event_type}: {details}",
            extra={
                'user': user,
                'action': 'security_event'
            }
        )
```

**å®¡è®¡æ—¥å¿—ç¤ºä¾‹**ï¼š
```
[2025-10-15 10:23:45] [INFO] [john@example.com] [obfuscation_start] æ··æ·†å¼€å§‹ project=MyApp config_hash=a1b2c3d4
[2025-10-15 10:28:12] [INFO] [john@example.com] [obfuscation_complete] æ··æ·†å®Œæˆ - æˆåŠŸ: True, æ–‡ä»¶: 234
[2025-10-15 10:30:00] [WARNING] [john@example.com] [config_export] é…ç½®å¯¼å‡º - ID: cfg_20251015_001
[2025-10-15 11:15:30] [INFO] [jane@example.com] [mapping_access] è®¿é—®æ˜ å°„æ–‡ä»¶ - /path/to/mapping.json
```

---

### ä¼ä¸šçº§ç‰¹æ€§æ€»ç»“

| ç‰¹æ€§ | ä»·å€¼ | å¤æ‚åº¦ | ä¼˜å…ˆçº§ |
|------|------|--------|--------|
| å›¢é˜Ÿé…ç½®åŒæ­¥ | ç¡®ä¿å›¢é˜Ÿä¸€è‡´æ€§ | ä¸­ | P0 |
| æ··æ·†å†å²ç®¡ç† | ä¾¿äºå›æº¯å’Œè°ƒè¯• | ä½ | P1 |
| æ•ˆæœè¯„ä¼° | é‡åŒ–æ··æ·†æ•ˆæœ | é«˜ | P1 |
| å¯è§†åŒ–æŠ¥å‘Š | ç›´è§‚å±•ç¤ºæ··æ·†ç»“æœ | ä¸­ | P2 |
| å®‰å…¨å®¡è®¡æ—¥å¿— | åˆè§„æ€§å’Œå®‰å…¨æ€§ | ä½ | P0 |

**å®æ–½æ—¶é—´çº¿**ï¼š
- Week 1-2ï¼šå›¢é˜Ÿé…ç½®åŒæ­¥ + å®‰å…¨å®¡è®¡æ—¥å¿—
- Week 3ï¼šæ··æ·†å†å²ç®¡ç†
- Week 4-5ï¼šæ•ˆæœè¯„ä¼° + å¯è§†åŒ–æŠ¥å‘Š

---

## å®æ–½è·¯çº¿å›¾æ€»ç»“

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2ä¸ªæœˆï¼‰

```
v2.3.0 - æ€§èƒ½ä¼˜åŒ– (2å‘¨)
â”œâ”€ Week 1: å¤šçº¿ç¨‹å¹¶è¡Œ + ç¼“å­˜æœºåˆ¶
â””â”€ Week 2: æµå¼å¤„ç† + æ€§èƒ½ç›‘æ§

v2.4.0 - åŠŸèƒ½å¢å¼º (3å‘¨)
â”œâ”€ Week 1-2: Swiftæ³›å‹ + æ–¹æ³•é‡è½½
â””â”€ Week 3: åè®®æ‰©å±• + Blockæ··æ·†
```

### ä¸­æœŸç›®æ ‡ï¼ˆ2-4ä¸ªæœˆï¼‰

```
v2.5.0 - ä½“éªŒä¼˜åŒ– (2å‘¨)
â”œâ”€ Week 1: é…ç½®é¢„è®¾ + å®æ—¶é¢„è§ˆ
â””â”€ Week 2: å‰åå¯¹æ¯” + å‹å¥½é”™è¯¯

v3.0.0 - ä¼ä¸šçº§ (4å‘¨)
â”œâ”€ Week 1-2: å›¢é˜Ÿåä½œ + å®¡è®¡æ—¥å¿—
â”œâ”€ Week 3: æ··æ·†å†å²ç®¡ç†
â””â”€ Week 4: æ•ˆæœè¯„ä¼° + å¯è§†åŒ–
```

### é•¿æœŸæ„¿æ™¯ï¼ˆ6-12ä¸ªæœˆï¼‰

1. **AIè¾…åŠ©æ··æ·†** (v3.1.0)
   - ä½¿ç”¨æœºå™¨å­¦ä¹ ä¼˜åŒ–æ··æ·†ç­–ç•¥
   - è‡ªåŠ¨è¯†åˆ«å…³é”®ä»£ç 
   - æ™ºèƒ½ç™½åå•å»ºè®®

2. **äº‘ç«¯æ··æ·†æœåŠ¡** (v3.2.0)
   - SaaSæ··æ·†æœåŠ¡
   - åˆ†å¸ƒå¼æ··æ·†
   - APIæ¥å£

3. **è·¨å¹³å°æ”¯æŒ** (v4.0.0)
   - Androidæ··æ·†æ”¯æŒ
   - Flutter/React Nativeæ”¯æŒ
   - ç»Ÿä¸€æ··æ·†å¹³å°

---

## å…³é”®æŒ‡æ ‡å’Œç›®æ ‡

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰ | v2.3.0 | v3.0.0 |
|------|------|--------|--------|
| å°é¡¹ç›®æ··æ·†æ—¶é—´ | 10ç§’ | 3ç§’ | 2ç§’ |
| å¤§é¡¹ç›®æ··æ·†æ—¶é—´ | 300ç§’ | 50ç§’ | 30ç§’ |
| å†…å­˜å ç”¨ | 500MB | 250MB | 150MB |
| ç¼“å­˜å‘½ä¸­åŠ é€Ÿ | æ—  | 100å€ | 200å€ |

### åŠŸèƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰ | v2.4.0 | v3.0.0 |
|------|------|--------|--------|
| Swiftç‰¹æ€§æ”¯æŒ | 80% | 95% | 100% |
| ObjCç‰¹æ€§æ”¯æŒ | 90% | 95% | 100% |
| æ··æ·†è¦†ç›–ç‡ | 85% | 92% | 95% |
| ç™½åå•å‡†ç¡®æ€§ | 95% | 98% | 99% |

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰ | v2.5.0 | v3.0.0 |
|------|------|--------|--------|
| é¦–æ¬¡ä½¿ç”¨æˆåŠŸç‡ | 70% | 85% | 95% |
| é…ç½®é”™è¯¯ç‡ | 15% | 5% | 2% |
| ç”¨æˆ·æ»¡æ„åº¦ | 3.5/5 | 4.2/5 | 4.7/5 |
| æ–‡æ¡£å®Œæ•´åº¦ | 80% | 90% | 95% |

---

## é£é™©ç®¡ç†

### æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| æ€§èƒ½ä¼˜åŒ–å¼•å…¥Bug | é«˜ | ä¸­ | å……åˆ†æµ‹è¯•ã€æ¸è¿›å¼ä¼˜åŒ– |
| Swiftæ–°ç‰¹æ€§æ”¯æŒå›°éš¾ | ä¸­ | ä¸­ | å‚è€ƒå¼€æºé¡¹ç›®ã€åˆ†é˜¶æ®µå®æ–½ |
| å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜ | é«˜ | ä½ | ä¸¥æ ¼å•å…ƒæµ‹è¯•ã€ä»£ç å®¡æŸ¥ |

### è¿›åº¦é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| åŠŸèƒ½å¼€å‘è¶…æœŸ | ä¸­ | ä¸­ | æ—¶é—´ç¼“å†²ã€åŠŸèƒ½ä¼˜å…ˆçº§ |
| æµ‹è¯•ä¸å……åˆ† | é«˜ | ä½ | æµ‹è¯•é©±åŠ¨å¼€å‘ã€CI/CD |
| æ–‡æ¡£æ»å | ä½ | é«˜ | å¼€å‘åŒæ­¥æ›´æ–°æ–‡æ¡£ |

### èµ„æºé£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| å¼€å‘äººå‘˜ä¸è¶³ | é«˜ | ä½ | åˆç†æ’æœŸã€å¤–éƒ¨æ”¯æŒ |
| æ—¶é—´æŠ•å…¥ä¸å¤Ÿ | ä¸­ | ä¸­ | ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½ã€MVPä¼˜å…ˆ |

---

## èµ„æºéœ€æ±‚

### äººå‘˜éœ€æ±‚

- **æ ¸å¿ƒå¼€å‘** (1-2äºº): æ··æ·†å¼•æ“ã€ä»£ç è§£æ/è½¬æ¢
- **å‰ç«¯å¼€å‘** (1äºº): GUIç•Œé¢ä¼˜åŒ–
- **æµ‹è¯•å·¥ç¨‹å¸ˆ** (1äºº): æµ‹è¯•ç”¨ä¾‹ã€è‡ªåŠ¨åŒ–æµ‹è¯•
- **æŠ€æœ¯å†™ä½œ** (0.5äºº): æ–‡æ¡£ç¼–å†™ã€æ•™ç¨‹åˆ¶ä½œ

### æ—¶é—´ä¼°ç®—

- **v2.3.0 (æ€§èƒ½ä¼˜åŒ–)**: 2å‘¨
- **v2.4.0 (åŠŸèƒ½å¢å¼º)**: 3å‘¨
- **v2.5.0 (ä½“éªŒä¼˜åŒ–)**: 2å‘¨
- **v3.0.0 (ä¼ä¸šçº§)**: 4å‘¨

**æ€»è®¡**: 11å‘¨ï¼ˆçº¦3ä¸ªæœˆï¼‰

### é¢„ç®—è€ƒè™‘

- **å¼€å‘æˆæœ¬**: æ ¹æ®å›¢é˜Ÿè§„æ¨¡
- **æµ‹è¯•è®¾å¤‡**: iOSçœŸæœºæµ‹è¯•
- **äº‘æœåŠ¡**: å›¢é˜Ÿé…ç½®åŒæ­¥æœåŠ¡å™¨
- **ç¬¬ä¸‰æ–¹å·¥å…·**: CI/CDã€ç›‘æ§å·¥å…·

---

## æˆåŠŸæ ‡å‡†

### æŠ€æœ¯æ ‡å‡†

âœ… **æ€§èƒ½**: å¤§é¡¹ç›®æ··æ·†æ—¶é—´ < 1åˆ†é’Ÿ
âœ… **ç¨³å®šæ€§**: æ··æ·†æˆåŠŸç‡ > 99%
âœ… **å‡†ç¡®æ€§**: ç™½åå•è¯†åˆ«å‡†ç¡®ç‡ > 98%
âœ… **å…¼å®¹æ€§**: æ”¯æŒiOS 12-18å…¨ç‰ˆæœ¬

### ç”¨æˆ·æ ‡å‡†

âœ… **æ˜“ç”¨æ€§**: æ–°ç”¨æˆ·10åˆ†é’Ÿå†…å®Œæˆé¦–æ¬¡æ··æ·†
âœ… **æ»¡æ„åº¦**: ç”¨æˆ·è¯„åˆ† > 4.5/5
âœ… **é‡‡ç”¨ç‡**: æœˆæ´»ç”¨æˆ·å¢é•¿ > 20%
âœ… **ç•™å­˜ç‡**: 30å¤©ç•™å­˜ç‡ > 70%

### å•†ä¸šæ ‡å‡†

âœ… **å¸‚åœºåœ°ä½**: æˆä¸ºä¸šç•Œé¢†å…ˆçš„iOSæ··æ·†å·¥å…·
âœ… **ç”¨æˆ·å¢é•¿**: å¹´å¢é•¿ > 100%
âœ… **å•†ä¸šåŒ–**: ä¼ä¸šç‰ˆè½¬åŒ–ç‡ > 10%

---

## ç»“è®º

æœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’äº†iOSæ··æ·†åŠŸèƒ½ä»v2.2.0åˆ°v3.0.0çš„å‘å±•è·¯å¾„ï¼Œæ¶µç›–**æ€§èƒ½ä¼˜åŒ–**ã€**åŠŸèƒ½å¢å¼º**ã€**ç”¨æˆ·ä½“éªŒ**å’Œ**ä¼ä¸šçº§ç‰¹æ€§**å››å¤§æ–¹å‘ã€‚

### æ ¸å¿ƒä¼˜åŠ¿

1. **æ€§èƒ½å“è¶Š**: é€šè¿‡å¤šçº¿ç¨‹ã€æµå¼å¤„ç†ç­‰æŠ€æœ¯ï¼Œå®ç°ç§’çº§æ··æ·†
2. **åŠŸèƒ½å®Œæ•´**: è¦†ç›–Swift/ObjCæ‰€æœ‰ä¸»æµç‰¹æ€§
3. **ä½“éªŒä¼˜ç§€**: é…ç½®é¢„è®¾ã€å®æ—¶é¢„è§ˆç­‰æå‡æ˜“ç”¨æ€§
4. **ä¼ä¸šå°±ç»ª**: å›¢é˜Ÿåä½œã€å®¡è®¡æ—¥å¿—ç­‰æ»¡è¶³ä¼ä¸šéœ€æ±‚

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**: v2.3.0æ€§èƒ½ä¼˜åŒ–ï¼ˆå¤šçº¿ç¨‹å¹¶è¡Œï¼‰
2. **æŒç»­è¿­ä»£**: æŒ‰ä¼˜å…ˆçº§é€æ­¥å®ç°å„é¡¹åŠŸèƒ½
3. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†çœŸå®ç”¨æˆ·ä½¿ç”¨åé¦ˆ
4. **ç¤¾åŒºå‚ä¸**: å¼€æºéƒ¨åˆ†ç»„ä»¶ï¼Œå»ºç«‹ç”Ÿæ€

### ä¿æŒè”ç³»

- ğŸ“§ Email: support@example.com
- ğŸ’¬ è®¨è®ºç¾¤: https://t.me/ios_obfuscation
- ğŸ“– æ–‡æ¡£: https://docs.example.com
- ğŸ› åé¦ˆ: https://github.com/user/project/issues

---

**æ–‡æ¡£ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-10-14
**ç‰ˆæœ¬**: v1.0
